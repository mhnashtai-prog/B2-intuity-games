<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>INTUITY - Sentence Sequencing</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Space+Grotesk:wght@400;500;600;700&family=DM+Sans:wght@400;500;600;700&family=Crimson+Text:wght@400;600;700&display=swap" rel="stylesheet">
  
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: 'DM Sans', 'Inter', -apple-system, BlinkMacSystemFont, 'SF Pro Display', sans-serif;
      background: #0d0d0d;
      color: white;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      overflow-x: hidden;
      min-height: 100vh;
      position: relative;
    }

    .background {
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      background: radial-gradient(circle at 30% 20%, rgba(201, 169, 97, 0.18) 0%, transparent 40%),
                  radial-gradient(circle at 70% 80%, rgba(201, 169, 97, 0.16) 0%, transparent 38%),
                  radial-gradient(circle at 20% 70%, rgba(201, 169, 97, 0.12) 0%, transparent 45%),
                  radial-gradient(circle at 85% 15%, rgba(201, 169, 97, 0.14) 0%, transparent 35%),
                  #0d0d0d;
      z-index: 0;
      overflow: hidden;
    }

    .elegant-curves {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      pointer-events: none;
    }

    .curve-elegant {
      position: absolute;
      border-radius: 50%;
      filter: blur(2px);
    }

    .curve-elegant-1 {
      width: 500px;
      height: 900px;
      top: -300px;
      right: -150px;
      border: 3px solid rgba(201, 169, 97, 0.35);
      background: linear-gradient(135deg, rgba(201, 169, 97, 0.15) 0%, rgba(201, 169, 97, 0.08) 50%, transparent 100%);
      transform: rotate(25deg);
      animation: floatElegant 12s ease-in-out infinite;
      box-shadow: inset 0 0 60px rgba(201, 169, 97, 0.1), 0 0 80px rgba(201, 169, 97, 0.15);
    }

    .curve-elegant-2 {
      width: 600px;
      height: 1100px;
      bottom: -400px;
      left: -200px;
      border: 2.5px solid rgba(201, 169, 97, 0.32);
      background: linear-gradient(135deg, rgba(201, 169, 97, 0.12) 0%, rgba(201, 169, 97, 0.06) 40%, transparent 80%);
      transform: rotate(-20deg);
      animation: floatElegant 15s ease-in-out infinite reverse;
      box-shadow: inset 0 0 50px rgba(201, 169, 97, 0.08), 0 0 70px rgba(201, 169, 97, 0.12);
    }

    .curve-elegant-3 {
      width: 400px;
      height: 750px;
      top: 25%;
      right: -50px;
      border: 2px solid rgba(201, 169, 97, 0.28);
      background: linear-gradient(135deg, rgba(201, 169, 97, 0.10) 0%, rgba(201, 169, 97, 0.05) 50%, transparent 90%);
      transform: rotate(45deg);
      animation: driftElegant 18s ease-in-out infinite;
      box-shadow: inset 0 0 40px rgba(201, 169, 97, 0.07), 0 0 60px rgba(201, 169, 97, 0.10);
    }

    .curve-elegant-4 {
      width: 450px;
      height: 850px;
      top: 50%;
      left: -100px;
      border: 2.5px solid rgba(201, 169, 97, 0.30);
      background: linear-gradient(135deg, rgba(201, 169, 97, 0.11) 0%, transparent 70%);
      transform: rotate(-35deg);
      animation: pulseElegant 20s ease-in-out infinite;
      box-shadow: inset 0 0 45px rgba(201, 169, 97, 0.08), 0 0 65px rgba(201, 169, 97, 0.11);
    }

    @keyframes floatElegant {
      0%, 100% { transform: translateY(0) rotate(var(--base-rotation, 0deg)); opacity: 1; }
      50% { transform: translateY(-30px) rotate(calc(var(--base-rotation, 0deg) + 3deg)); opacity: 0.85; }
    }

    @keyframes driftElegant {
      0%, 100% { transform: translate(0, 0) rotate(45deg); opacity: 1; }
      33% { transform: translate(20px, -25px) rotate(48deg); opacity: 0.9; }
      66% { transform: translate(-10px, -15px) rotate(42deg); opacity: 0.95; }
    }

    @keyframes pulseElegant {
      0%, 100% { transform: translate(0, 0) scale(1) rotate(-35deg); opacity: 1; }
      50% { transform: translate(-15px, 10px) scale(1.05) rotate(-33deg); opacity: 0.9; }
    }

    .curve-elegant-1 { --base-rotation: 25deg; }
    .curve-elegant-2 { --base-rotation: -20deg; }

    body::before {
      content: '';
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' /%3E%3C/filter%3E%3Crect width='100' height='100' filter='url(%23noise)' opacity='0.01'/%3E%3C/svg%3E");
      pointer-events: none;
      z-index: 1;
    }

    .container { 
      max-width: 900px; 
      margin: 0 auto; 
      position: relative;
      z-index: 2;
      padding: 0 1rem;
    }

    /* BACK BUTTON */
    .back-btn {
      position: fixed;
      top: 1.5rem;
      left: 1.5rem;
      padding: 0.625rem 1.25rem;
      background: rgba(28, 28, 30, 0.9);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid rgba(84, 84, 88, 0.3);
      border-radius: 999px;
      color: #C9A961;
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.5);
      z-index: 1000;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      border-style: solid;
    }

    .back-btn:hover {
      background: rgba(28, 28, 30, 1);
      border-color: rgba(201, 169, 97, 0.5);
      transform: translateX(-3px);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.6);
    }

    /* HEADER */
    .header { 
      text-align: center; 
      margin-bottom: 2.5rem;
      padding: 1.5rem 0 1rem;
    }

    .header h1 {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 2.25rem; 
      font-weight: 700; 
      color: #C9A961;
      margin-bottom: 0.5rem; 
      letter-spacing: -0.04em;
      text-transform: uppercase;
      background: linear-gradient(135deg, #C9A961 0%, rgba(201, 169, 97, 0.8) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .header .subtitle { 
      font-size: 0.8125rem; 
      color: #8e8e93; 
      margin-bottom: 0.375rem;
      font-weight: 500;
      letter-spacing: 0.04em;
      text-transform: uppercase;
    }

    /* GAME SCREEN */
    .game-screen {
      display: none;
      padding: 1rem;
    }

    .game-screen.active {
      display: block;
    }

    .game-container {
      background: rgba(28, 28, 30, 0.98);
      backdrop-filter: blur(60px) saturate(180%);
      -webkit-backdrop-filter: blur(60px) saturate(180%);
      border: 1px solid rgba(84, 84, 88, 0.4);
      border-radius: 1.5rem;
      padding: 1rem 1rem 1.5rem 1rem;
      max-width: 900px;
      margin: 0 auto;
      box-shadow: 0 25px 50px rgba(0,0,0,0.6), 0 8px 24px rgba(0, 0, 0, 0.4);
    }

    .game-title {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 1.0625rem;
      font-weight: 600;
      color: #C9A961;
      text-align: center;
      margin-bottom: 0.25rem;
      padding-bottom: 0.625rem;
      border-bottom: 1px solid rgba(84, 84, 88, 0.3);
      text-transform: uppercase;
      letter-spacing: 0.02em;
    }

    .game-hint {
      text-align: center;
      font-size: 0.95rem;
      color: #6b7280;
      margin-bottom: 0.875rem;
      font-weight: 500;
      letter-spacing: 0.01em;
    }

    /* LEGEND */
    .legend {
      display: flex;
      gap: 1rem;
      justify-content: center;
      flex-wrap: wrap;
      margin-bottom: 1rem;
      padding: 0.625rem 0.75rem;
      background: rgba(15, 15, 17, 0.5);
      border-radius: 0.75rem;
      border: 1px solid rgba(84, 84, 88, 0.2);
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 0.375rem;
      font-size: 0.6875rem;
      font-weight: 600;
      color: #8e8e93;
      text-transform: uppercase;
      letter-spacing: 0.04em;
    }

    .legend-swatch {
      width: 14px;
      height: 14px;
      border-radius: 4px;
      border: 1.5px solid rgba(255,255,255,0.15);
      flex-shrink: 0;
    }

    .legend-icon {
      font-size: 0.75rem;
    }

    /* SENTENCES DISPLAY */
    .sentences-display {
      background: linear-gradient(180deg, rgba(15, 15, 17, 0.6) 0%, rgba(20, 20, 22, 0.5) 100%);
      border-radius: 1rem;
      border: 1px solid rgba(84, 84, 88, 0.25);
      padding: 0.625rem;
      margin-bottom: 1.25rem;
      max-height: 640px;
      overflow-y: auto;
      box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.3);
    }

    .sentences-display:empty,
    .sentences-display:not(:has(.sentence-card)) {
      display: none;
    }

    .sentences-grid {
      display: flex;
      flex-direction: column;
      gap: 0.35rem;
    }

    /* PARAGRAPH SEPARATOR */
    .paragraph-separator {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.5rem 0.5rem 0.25rem;
      margin-top: 0.25rem;
    }

    .paragraph-separator:first-child {
      margin-top: 0;
      padding-top: 0.25rem;
    }

    .separator-line {
      flex: 1;
      height: 1px;
      background: rgba(84, 84, 88, 0.3);
    }

    .separator-label {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 0.5625rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: #6b7280;
      white-space: nowrap;
    }

    /* SENTENCE CARD BASE */
    .sentence-card {
      background: rgba(255, 255, 255, 0.88);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      border: 1.5px solid rgba(255, 255, 255, 0.5);
      border-radius: 1rem;
      padding: 0.5rem 0.875rem;
      min-height: auto;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      display: flex;
      gap: 0.625rem;
      align-items: center;
      cursor: pointer;
      position: relative;
      overflow: hidden;
      box-shadow: 0 1px 4px rgba(0, 0, 0, 0.04), 0 4px 16px rgba(0, 0, 0, 0.03);
    }

    .sentence-card::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      width: 4px;
      height: 100%;
      background: #C9A961;
      opacity: 0;
      transition: opacity 0.25s;
      border-radius: 4px 0 0 4px;
    }

    .sentence-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08), 0 1px 4px rgba(0, 0, 0, 0.04);
      border-color: rgba(201, 169, 97, 0.25);
    }

    .sentence-card:hover::before {
      opacity: 0.6;
    }

    .sentence-card:active {
      transform: translateY(0) scale(0.995);
    }

    /* ‚îÄ‚îÄ FIXED (ANCHOR) SENTENCE ‚îÄ‚îÄ */
    .sentence-card.fixed-sentence {
      background: rgba(22, 22, 30, 0.92);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border: 1.5px solid rgba(201, 169, 97, 0.3);
      cursor: default;
      box-shadow: 0 2px 12px rgba(0, 0, 0, 0.12), 0 0 0 1px rgba(201, 169, 97, 0.08);
    }

    .sentence-card.fixed-sentence::before {
      opacity: 1;
      background: #C9A961;
      width: 4px;
    }

    .sentence-card.fixed-sentence:hover {
      transform: none;
      box-shadow: 0 2px 12px rgba(0, 0, 0, 0.12), 0 0 0 1px rgba(201, 169, 97, 0.08);
      border-color: rgba(201, 169, 97, 0.3);
    }

    .sentence-card.fixed-sentence .sentence-text-display {
      color: #e8e0d0;
      font-weight: 700;
    }

    .sentence-card.fixed-sentence .sentence-label {
      background: rgba(201, 169, 97, 0.25);
      color: #C9A961;
    }

    .fixed-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      font-family: 'Space Grotesk', sans-serif;
      font-size: 0.5625rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      color: #C9A961;
      background: rgba(201, 169, 97, 0.12);
      border: 1px solid rgba(201, 169, 97, 0.25);
      border-radius: 999px;
      padding: 0.175rem 0.5rem;
      flex-shrink: 0;
      white-space: nowrap;
    }

    .fixed-badge svg {
      width: 10px;
      height: 10px;
      fill: #C9A961;
    }

    /* ‚îÄ‚îÄ PARAGRAPH COLOR TONES ‚îÄ‚îÄ */
    .sentence-card.para-tone-0 { border-left: 3.5px solid rgba(201, 169, 97, 0.5); }
    .sentence-card.para-tone-1 { border-left: 3.5px solid rgba(110, 179, 162, 0.55); }
    .sentence-card.para-tone-2 { border-left: 3.5px solid rgba(167, 139, 200, 0.55); }
    .sentence-card.para-tone-3 { border-left: 3.5px solid rgba(200, 139, 139, 0.5); }
    .sentence-card.para-tone-4 { border-left: 3.5px solid rgba(139, 170, 200, 0.55); }
    .sentence-card.para-tone-5 { border-left: 3.5px solid rgba(200, 180, 120, 0.5); }

    /* Fixed sentences ‚Äî left accent colour */
    .sentence-card.fixed-sentence.para-tone-0 { border-left: 3.5px solid rgba(201, 169, 97, 0.6); }
    .sentence-card.fixed-sentence.para-tone-1 { border-left: 3.5px solid rgba(110, 179, 162, 0.65); }
    .sentence-card.fixed-sentence.para-tone-2 { border-left: 3.5px solid rgba(167, 139, 200, 0.65); }
    .sentence-card.fixed-sentence.para-tone-3 { border-left: 3.5px solid rgba(200, 139, 139, 0.6); }
    .sentence-card.fixed-sentence.para-tone-4 { border-left: 3.5px solid rgba(139, 170, 200, 0.65); }
    .sentence-card.fixed-sentence.para-tone-5 { border-left: 3.5px solid rgba(200, 180, 120, 0.6); }

    /* Movable card subtle washes ‚Äî frosted tints */
    .sentence-card:not(.fixed-sentence).para-tone-0 { background: rgba(245, 238, 220, 0.92); }
    .sentence-card:not(.fixed-sentence).para-tone-1 { background: rgba(225, 242, 236, 0.92); }
    .sentence-card:not(.fixed-sentence).para-tone-2 { background: rgba(237, 230, 247, 0.92); }
    .sentence-card:not(.fixed-sentence).para-tone-3 { background: rgba(247, 230, 230, 0.92); }
    .sentence-card:not(.fixed-sentence).para-tone-4 { background: rgba(228, 237, 247, 0.92); }
    .sentence-card:not(.fixed-sentence).para-tone-5 { background: rgba(243, 238, 222, 0.92); }

    .sentence-card.has-number {
      border-color: rgba(201, 169, 97, 0.35);
      box-shadow: 0 2px 12px rgba(201, 169, 97, 0.12), 0 1px 3px rgba(0, 0, 0, 0.04);
    }

    .sentence-card.has-number::before {
      opacity: 0.8;
      background: #C9A961;
    }

    .sentence-card.multi-line {
      padding: 0.5rem 0.75rem;
    }

    .sentence-card.duplicate-number {
      background: rgba(254, 243, 232, 0.95) !important;
      border-color: rgba(239, 68, 68, 0.35) !important;
      box-shadow: 0 0 0 2px rgba(239, 68, 68, 0.1);
      animation: pulseWarning 1.5s ease-in-out infinite;
    }

    .sentence-card.duplicate-number::before {
      background: #f59e0b;
      opacity: 1;
    }

    @keyframes pulseWarning {
      0%, 100% { box-shadow: 0 0 0 2px rgba(239, 68, 68, 0.1); }
      50% { box-shadow: 0 0 0 4px rgba(239, 68, 68, 0.12); }
    }

    .sentence-card.correct {
      border-color: rgba(16, 185, 129, 0.4) !important;
      background: rgba(236, 253, 245, 0.95) !important;
      box-shadow: 0 2px 12px rgba(16, 185, 129, 0.12);
    }

    .sentence-card.correct::before {
      background: #10b981;
      opacity: 1;
    }

    .sentence-card.incorrect {
      border-color: rgba(239, 68, 68, 0.35) !important;
      background: rgba(254, 242, 242, 0.95) !important;
      box-shadow: 0 2px 12px rgba(239, 68, 68, 0.1);
    }

    .sentence-card.incorrect::before {
      background: #ef4444;
      opacity: 1;
    }

    .sentence-label {
      font-family: 'DM Sans', 'Inter', sans-serif;
      font-size: 0.6rem;
      font-weight: 700;
      color: #7a6530;
      background: rgba(201, 169, 97, 0.2);
      padding: 0.2rem 0.45rem;
      border-radius: 999px;
      text-align: center;
      min-width: 32px;
      flex-shrink: 0;
      letter-spacing: 0.01em;
    }

    .sentence-content {
      flex: 1;
      display: flex;
      gap: 1rem;
      align-items: center;
    }

    .sentence-text-display {
      flex: 1;
      font-family: 'Crimson Text', serif;
      font-size: 0.9rem;
      line-height: 1.35;
      color: #1c1c1e;
      font-weight: 600;
    }

    .linking-word {
      color: #dc2626;
      font-weight: 700;
      padding: 0 0.125rem;
    }

    .sentence-input {
      flex-shrink: 0;
    }

    .sentence-input input {
      width: 42px;
      padding: 0.35rem;
      text-align: center;
      font-size: 0.85rem;
      font-weight: 700;
      border: 1.5px solid rgba(201, 169, 97, 0.35);
      border-radius: 0.625rem;
      background: rgba(255, 255, 255, 0.7);
      color: #1c1c1e;
      transition: all 0.25s;
    }

    .sentence-input input:focus {
      outline: none;
      border-color: #C9A961;
      box-shadow: 0 0 0 3px rgba(201, 169, 97, 0.15);
      background: #fff;
      transform: scale(1.06);
    }

    .sentence-input label {
      display: block;
      font-family: 'Space Grotesk', sans-serif;
      font-size: 0.625rem;
      font-weight: 700;
      color: #6b7280;
      margin-bottom: 0.25rem;
      text-align: center;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    /* Fixed sentence position display (non-editable) */
    .fixed-position {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 0.8rem;
      font-weight: 800;
      color: #C9A961;
      background: rgba(201, 169, 97, 0.15);
      border: 2px solid rgba(201, 169, 97, 0.3);
      border-radius: 0.5rem;
      width: 48px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }

    /* ‚îÄ‚îÄ ACTION BAR (compact pill strip) ‚îÄ‚îÄ */
    .game-actions {
      display: flex;
      gap: 0.5rem;
      justify-content: center;
      align-items: center;
      flex-wrap: wrap;
      background: rgba(255, 255, 255, 0.04);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      border: 1px solid rgba(255, 255, 255, 0.06);
      border-radius: 999px;
      padding: 0.35rem;
      max-width: fit-content;
      margin: 0 auto;
    }

    .game-btn {
      font-family: 'DM Sans', 'Inter', sans-serif;
      font-size: 0.7rem;
      font-weight: 600;
      letter-spacing: 0.01em;
      padding: 0.5rem 1.125rem;
      border: none;
      border-radius: 999px;
      cursor: pointer;
      transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      white-space: nowrap;
      position: relative;
      overflow: hidden;
    }

    .game-btn .btn-icon {
      font-size: 0.85rem;
      line-height: 1;
    }

    .btn-submit {
      background: #C9A961;
      color: #111;
      font-weight: 700;
      box-shadow: 0 2px 10px rgba(201, 169, 97, 0.35);
    }

    .btn-submit:hover:not(:disabled) {
      background: #d4b46e;
      box-shadow: 0 4px 18px rgba(201, 169, 97, 0.5);
      transform: scale(1.04);
    }

    .btn-submit:active:not(:disabled) {
      transform: scale(0.97);
      box-shadow: 0 1px 6px rgba(201, 169, 97, 0.3);
    }

    .btn-submit:disabled {
      opacity: 0.4;
      cursor: not-allowed;
    }

    .btn-retry {
      background: rgba(255, 255, 255, 0.08);
      color: #d4d4d8;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .btn-retry:hover {
      background: rgba(255, 255, 255, 0.14);
      color: #fff;
      transform: scale(1.04);
    }

    .btn-new {
      background: rgba(255, 255, 255, 0.05);
      color: #8e8e93;
      border: 1px solid rgba(255, 255, 255, 0.06);
    }

    .btn-new:hover {
      background: rgba(255, 255, 255, 0.1);
      color: #C9A961;
      transform: scale(1.04);
    }

    .btn-answers {
      background: rgba(99, 140, 255, 0.1);
      color: #7ba4ff;
      border: 1px solid rgba(99, 140, 255, 0.15);
    }

    .btn-answers:hover {
      background: rgba(99, 140, 255, 0.18);
      color: #a0bfff;
      transform: scale(1.04);
    }

    .btn-answers.showing-answers {
      background: rgba(99, 140, 255, 0.22);
      color: #fff;
      border-color: rgba(99, 140, 255, 0.3);
    }

    .btn-answers.showing-answers:hover {
      background: rgba(99, 140, 255, 0.3);
    }

    /* ANSWER KEY DISPLAY */
    .answer-key-display {
      display: none;
      background: linear-gradient(135deg, rgba(59, 130, 246, 0.12) 0%, rgba(37, 99, 235, 0.08) 100%);
      border: 2px solid rgba(59, 130, 246, 0.4);
      border-radius: 1.125rem;
      padding: 0;
      margin-bottom: 1.5rem;
      overflow: hidden;
      box-shadow: 0 4px 20px rgba(59, 130, 246, 0.15);
    }

    .answer-key-display.show {
      display: block;
      animation: slideIn 0.4s ease-out;
    }

    .answer-key-header {
      background: linear-gradient(135deg, rgba(59, 130, 246, 0.2) 0%, rgba(37, 99, 235, 0.15) 100%);
      padding: 1rem 1.25rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid rgba(59, 130, 246, 0.3);
    }

    .answer-key-title {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 1rem;
      font-weight: 700;
      color: #3b82f6;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .close-answers {
      background: rgba(59, 130, 246, 0.15);
      border: 1px solid rgba(59, 130, 246, 0.3);
      color: #3b82f6;
      font-size: 1.25rem;
      font-weight: 700;
      width: 32px;
      height: 32px;
      border-radius: 0.5rem;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0;
      line-height: 1;
    }

    .close-answers:hover {
      background: rgba(59, 130, 246, 0.25);
      border-color: rgba(59, 130, 246, 0.5);
      transform: scale(1.1);
    }

    .answer-key-content {
      padding: 1.25rem;
      max-height: 400px;
      overflow-y: auto;
    }

    .answer-sentence {
      display: flex;
      gap: 0.875rem;
      align-items: flex-start;
      padding: 0.75rem 1rem;
      margin-bottom: 0.5rem;
      background: rgba(255, 255, 255, 0.5);
      border-radius: 0.75rem;
      border-left: 4px solid #3b82f6;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
    }

    .answer-sentence.answer-fixed {
      background: rgba(201, 169, 97, 0.12);
      border-left: 4px solid #C9A961;
    }

    .answer-number {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 1.125rem;
      font-weight: 800;
      min-width: 32px;
      height: 32px;
      background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
      color: white;
      border-radius: 0.5rem;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      box-shadow: 0 2px 6px rgba(59, 130, 246, 0.3);
    }

    .answer-sentence.answer-fixed .answer-number {
      background: linear-gradient(135deg, #C9A961 0%, #B89650 100%);
      color: #1a1a2e;
      box-shadow: 0 2px 6px rgba(201, 169, 97, 0.3);
    }

    .answer-text {
      flex: 1;
      font-family: 'Crimson Text', serif;
      font-size: 0.95rem;
      line-height: 1.5;
      color: #1c1c1e;
      font-weight: 600;
    }

    /* RESULTS */
    .results-display {
      display: none;
      background: linear-gradient(135deg, rgba(201, 169, 97, 0.15) 0%, rgba(201, 169, 97, 0.1) 100%);
      border: 2px solid rgba(201, 169, 97, 0.5);
      border-radius: 1.125rem;
      padding: 1.75rem;
      margin-bottom: 1.5rem;
      text-align: center;
      box-shadow: 0 4px 16px rgba(201, 169, 97, 0.2);
    }

    .results-display.show {
      display: block;
      animation: slideIn 0.5s ease-out;
    }

    @keyframes slideIn {
      from { opacity: 0; transform: translateY(-20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .results-score {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 2.75rem;
      font-weight: 800;
      color: #C9A961;
      margin-bottom: 0.625rem;
      text-shadow: 0 2px 8px rgba(201, 169, 97, 0.3);
    }

    .results-message {
      font-size: 1.0625rem;
      color: #f5f5f7;
      margin-bottom: 0.5rem;
      font-weight: 500;
    }

    .perfect-score {
      color: #10b981;
      text-shadow: 0 2px 8px rgba(16, 185, 129, 0.3);
    }

    /* Scrollbar */
    .sentences-display::-webkit-scrollbar { width: 8px; }
    .sentences-display::-webkit-scrollbar-track { background: rgba(0, 0, 0, 0.1); border-radius: 4px; }
    .sentences-display::-webkit-scrollbar-thumb {
      background: linear-gradient(180deg, #C9A961 0%, #B89650 50%);
      border-radius: 4px;
    }
    .sentences-display::-webkit-scrollbar-thumb:hover { 
      background: linear-gradient(180deg, #D4A574 0%, #C9A961 50%);
    }

    /* MOBILE */
    @media (max-width: 768px) {
      .back-btn {
        top: 1rem;
        left: 1rem;
        padding: 0.5rem 1rem;
        font-size: 0.65rem;
      }

      .sentence-text-display { font-size: 0.9rem; }

      .sentence-input input {
        width: 50px;
        padding: 0.4rem;
        font-size: 0.95rem;
      }

      .sentence-card {
        padding: 0.75rem 0.875rem;
        flex-direction: column;
        gap: 0.625rem;
        align-items: stretch;
      }

      .sentence-content {
        flex-direction: column;
        gap: 0.625rem;
        width: 100%;
      }

      .sentence-input {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        justify-content: flex-end;
      }

      .sentence-input label { margin-bottom: 0; }

      .game-btn {
        padding: 0.45rem 0.875rem;
        font-size: 0.65rem;
      }

      .legend {
        gap: 0.5rem;
      }

      .legend-item {
        font-size: 0.6rem;
      }
    }

    @media (max-width: 480px) {
      .game-container { padding: 1.5rem 1rem; }
    }
  </style>
</head>
<body>
  <div class="background">
    <div class="elegant-curves">
      <div class="curve-elegant curve-elegant-1"></div>
      <div class="curve-elegant curve-elegant-2"></div>
      <div class="curve-elegant curve-elegant-3"></div>
      <div class="curve-elegant curve-elegant-4"></div>
    </div>
  </div>

  <button class="back-btn" onclick="goBack()">
    <span>‚Üê</span>
    <span>Back</span>
  </button>

  <div class="container">
    <header class="header">
      <h1>INTUITY</h1>
      <p class="subtitle">Sentence Sequencing Challenge</p>
    </header>

    <div class="game-screen active" id="gameScreen">
      <div class="game-container">
        <h2 class="game-title" id="gameTitle"></h2>
        <p class="game-hint">Put the sentences into the correct order</p>

        <!-- LEGEND (dynamically populated) -->
        <div class="legend" id="legend"></div>

        <div class="sentences-display">
          <div class="sentences-grid" id="sentencesGrid"></div>
        </div>

        <div class="answer-key-display" id="answerKeyDisplay">
          <div class="answer-key-header">
            <span class="answer-key-title">‚úì Correct Sequence</span>
            <button class="close-answers" onclick="toggleAnswers()">‚úï</button>
          </div>
          <div class="answer-key-content" id="answerKeyContent"></div>
        </div>

        <div class="results-display" id="resultsDisplay">
          <div class="results-score" id="resultsScore">0%</div>
          <div class="results-message" id="resultsMessage">Keep trying!</div>
        </div>

        <div class="game-actions">
          <button class="game-btn btn-submit" id="submitBtn" onclick="checkAnswer()"><span class="btn-icon">‚úì</span> Check</button>
          <button class="game-btn btn-retry" id="retryBtn" onclick="retry()" style="display:none;"><span class="btn-icon">‚Üª</span> Retry</button>
          <button class="game-btn btn-answers" id="answersBtn" onclick="toggleAnswers()" style="display:none;"><span class="btn-icon">üëÅ</span> Answers</button>
          <button class="game-btn btn-new" onclick="newGame()"><span class="btn-icon">‚ü≥</span> New</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    let currentType = null;
    let currentData = null;
    let currentSample = null;
    let sentences = [];             // All sentences in correct order
    let paragraphMap = {};          // Maps global sentence index ‚Üí paragraph label
    let paragraphIndexMap = {};     // Maps global sentence index ‚Üí paragraph index (0, 1, 2...)
    let isFirstInParagraph = {};    // Maps global sentence index ‚Üí boolean (is it the first sentence?)
    let fixedPositions = {};        // Maps global sentence index ‚Üí its correct 1-based position
    let movableSentences = [];      // Only the non-fixed sentences (scrambled)
    let movableCorrectOrder = [];   // Correct positions for movable sentences
    let userPositions = {};         // User's assigned positions for movable sentences (keyed by scrambled index)
    let hasSubmitted = false;
    let showingAnswers = false;
    let totalSentences = 0;
    let paragraphLabels = [];       // Ordered unique paragraph labels

    // Paragraph tone colours for the legend and cards
    const PARA_COLORS = [
      { css: 'para-tone-0', color: 'rgba(201, 169, 97, 0.55)', name: '' },
      { css: 'para-tone-1', color: 'rgba(110, 179, 162, 0.6)', name: '' },
      { css: 'para-tone-2', color: 'rgba(167, 139, 200, 0.6)', name: '' },
      { css: 'para-tone-3', color: 'rgba(200, 139, 139, 0.55)', name: '' },
      { css: 'para-tone-4', color: 'rgba(139, 170, 200, 0.6)', name: '' },
      { css: 'para-tone-5', color: 'rgba(200, 180, 120, 0.55)', name: '' },
    ];

    const urlParams = new URLSearchParams(window.location.search);
    const contentType = urlParams.get('type') || 'essays';

    const isInSubfolder = window.location.pathname.includes('/skills/writing/');
    const dataPrefix = isInSubfolder ? '../../../' : '';
    
    const DATA_PATHS = {
      essays: `${dataPrefix}data/essays-models.json`,
      reports: `${dataPrefix}data/reports-models.json`,
      reviews: `${dataPrefix}data/reviews-models.json`,
      emails: `${dataPrefix}data/emails-models.json`
    };

    const LINKING_WORDS = [
      'however', 'therefore', 'moreover', 'furthermore', 'additionally', 'consequently',
      'meanwhile', 'nevertheless', 'nonetheless', 'thus', 'hence', 'accordingly',
      'besides', 'likewise', 'similarly', 'conversely', 'alternatively', 'specifically',
      'indeed', 'furthermore', 'meanwhile', 'subsequently', 'finally', 'firstly',
      'secondly', 'thirdly', 'lastly', 'in addition', 'in contrast', 'for example',
      'for instance', 'as a result', 'on the other hand', 'in conclusion', 'to sum up',
      'in summary', 'in brief', 'in short', 'overall', 'essentially', 'basically',
      'what is more', 'to begin with', 'to start with', 'by far', 'it is generally agreed',
      'it was generally felt', 'one positive aspect', 'one major concern', 'this is because',
      'this is mainly due to', 'as a consequence', 'what makes', 'what made'
    ];
    
    function goBack() {
      window.location.href = 'index.html';
    }

    window.addEventListener('DOMContentLoaded', () => {
      startGame(contentType);
    });
    
    async function startGame(type) {
      currentType = type;
      
      try {
        const response = await fetch(DATA_PATHS[type]);
        if (!response.ok) throw new Error(`Failed to load ${type}`);
        
        currentData = await response.json();
        const randomIndex = Math.floor(Math.random() * currentData.samples.length);
        currentSample = currentData.samples[randomIndex];
        
        extractSentences();
        
        document.getElementById('gameTitle').textContent = currentSample.topic || 'Sentence Sequencing Challenge';
        
        buildLegend();
        renderGame();
        
      } catch (error) {
        console.error('Error loading game:', error);
        alert('Failed to load game data. Please try again.');
      }
    }

    /**
     * CORE CHANGE: Extract sentences, mark first-of-paragraph as FIXED,
     * scramble only the remaining movable sentences.
     */
    function extractSentences() {
      sentences = [];
      paragraphMap = {};
      paragraphIndexMap = {};
      isFirstInParagraph = {};
      fixedPositions = {};
      paragraphLabels = [];
      
      let sentenceIndex = 0;
      
      currentSample.paragraphs.forEach((para, paraIdx) => {
        paragraphLabels.push(para.label);
        
        const paraSentences = para.text
          .split(/(?<=[.!?])\s+/)
          .filter(s => s.trim().length > 0)
          .map(s => s.trim());
        
        paraSentences.forEach((s, i) => {
          paragraphMap[sentenceIndex] = para.label;
          paragraphIndexMap[sentenceIndex] = paraIdx;
          
          // First sentence of each paragraph is FIXED
          if (i === 0) {
            isFirstInParagraph[sentenceIndex] = true;
            fixedPositions[sentenceIndex] = sentenceIndex + 1; // 1-based correct position
          } else {
            isFirstInParagraph[sentenceIndex] = false;
          }
          
          sentenceIndex++;
        });
        
        sentences.push(...paraSentences);
      });
      
      totalSentences = sentences.length;
      
      // Build movable sentences list (non-fixed)
      const movableIndices = [];
      sentences.forEach((s, i) => {
        if (!isFirstInParagraph[i]) {
          movableIndices.push(i);
        }
      });
      
      // Shuffle the movable indices
      const shuffledMovableIndices = [...movableIndices];
      shuffleArray(shuffledMovableIndices);
      
      // Build the movable sentences array with their original indices
      movableSentences = shuffledMovableIndices.map(origIdx => ({
        text: sentences[origIdx],
        originalIndex: origIdx,
        correctPosition: origIdx + 1 // 1-based
      }));
      
      console.log('Total sentences:', totalSentences);
      console.log('Fixed (anchors):', Object.keys(fixedPositions).length);
      console.log('Movable:', movableSentences.length);
    }

    function shuffleArray(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
    }

    function highlightLinkingWords(text) {
      let highlightedText = text;
      LINKING_WORDS.forEach(word => {
        const regex = new RegExp(`\\b(${word})\\b`, 'gi');
        highlightedText = highlightedText.replace(regex, '<span class="linking-word">$1</span>');
      });
      return highlightedText;
    }

    /**
     * Build the colour legend based on how many paragraphs exist.
     */
    function buildLegend() {
      const legend = document.getElementById('legend');
      legend.innerHTML = '';
      
      // Fixed anchor legend item
      const fixedItem = document.createElement('div');
      fixedItem.className = 'legend-item';
      fixedItem.innerHTML = `
        <span class="legend-icon">üîí</span>
        <span>Fixed opener</span>
      `;
      legend.appendChild(fixedItem);
      
      // Paragraph colour swatches
      paragraphLabels.forEach((label, idx) => {
        const toneIdx = idx % PARA_COLORS.length;
        const item = document.createElement('div');
        item.className = 'legend-item';
        item.innerHTML = `
          <span class="legend-swatch" style="background: ${PARA_COLORS[toneIdx].color};"></span>
          <span>${label}</span>
        `;
        legend.appendChild(item);
      });
    }

    function renderGame() {
      hasSubmitted = false;
      userPositions = {};
      
      document.getElementById('resultsDisplay').classList.remove('show');
      document.getElementById('submitBtn').style.display = 'inline-flex';
      document.getElementById('retryBtn').style.display = 'none';
      
      renderSentences();
    }

    /**
     * CORE RENDERING:
     * - Fixed sentences appear in their correct positions (dark cards, locked)
     * - Movable sentences appear below, scrambled, with input fields
     * - All cards are colour-coded by paragraph
     */
    function renderSentences() {
      const container = document.getElementById('sentencesGrid');
      container.innerHTML = '';
      
      // ‚îÄ‚îÄ‚îÄ SECTION 1: FIXED SENTENCES (anchors in correct position) ‚îÄ‚îÄ‚îÄ
      // Collect all fixed sentence indices, sorted by position
      const fixedIndices = Object.keys(fixedPositions).map(Number).sort((a, b) => a - b);
      
      fixedIndices.forEach((origIdx, i) => {
        const paraIdx = paragraphIndexMap[origIdx];
        const toneClass = PARA_COLORS[paraIdx % PARA_COLORS.length].css;
        const paraLabel = paragraphMap[origIdx];
        
        // Add paragraph separator
        const sep = document.createElement('div');
        sep.className = 'paragraph-separator';
        sep.innerHTML = `
          <span class="separator-line"></span>
          <span class="separator-label">${paraLabel}</span>
          <span class="separator-line"></span>
        `;
        container.appendChild(sep);
        
        const card = document.createElement('div');
        card.className = `sentence-card fixed-sentence ${toneClass}`;
        card.id = `card-fixed-${origIdx}`;
        
        const highlightedText = highlightLinkingWords(sentences[origIdx]);
        
        card.innerHTML = `
          <div class="sentence-label">S${origIdx + 1}</div>
          <div class="sentence-content">
            <div class="sentence-text-display">${highlightedText}</div>
            <div class="fixed-badge">
              <svg viewBox="0 0 16 16"><path d="M11.5 1a3.5 3.5 0 0 0-3.5 3.5V7H4a2 2 0 0 0-2 2v5a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2H9.5V4.5a2 2 0 1 1 4 0V6h1.5V4.5A3.5 3.5 0 0 0 11.5 1z"/></svg>
              <span>#${origIdx + 1}</span>
            </div>
          </div>
        `;
        
        container.appendChild(card);
      });
      
      // ‚îÄ‚îÄ‚îÄ SECTION 2: MOVABLE SENTENCES (scrambled) ‚îÄ‚îÄ‚îÄ
      if (movableSentences.length > 0) {
        const movSep = document.createElement('div');
        movSep.className = 'paragraph-separator';
        movSep.innerHTML = `
          <span class="separator-line"></span>
          <span class="separator-label">Sequence these sentences</span>
          <span class="separator-line"></span>
        `;
        container.appendChild(movSep);
      }
      
      // Sort movable by user position (positioned first, then unpositioned)
      const movableDisplay = movableSentences.map((item, scrambledIdx) => ({
        ...item,
        scrambledIdx,
        userPos: userPositions[scrambledIdx] || null
      }));
      
      const positioned = movableDisplay.filter(m => m.userPos !== null).sort((a, b) => a.userPos - b.userPos);
      const unpositioned = movableDisplay.filter(m => m.userPos === null);
      const displayOrder = [...positioned, ...unpositioned];
      
      // Check for duplicate positions
      const positionCounts = {};
      positioned.forEach(obj => {
        positionCounts[obj.userPos] = (positionCounts[obj.userPos] || 0) + 1;
      });
      
      // Get the set of positions already occupied by fixed sentences
      const fixedPositionValues = new Set(Object.values(fixedPositions));
      
      displayOrder.forEach(item => {
        const { text, originalIndex, scrambledIdx, userPos } = item;
        const paraIdx = paragraphIndexMap[originalIndex];
        const toneClass = PARA_COLORS[paraIdx % PARA_COLORS.length].css;
        
        const card = document.createElement('div');
        card.className = `sentence-card ${toneClass}`;
        card.id = `card-movable-${scrambledIdx}`;
        
        if (userPos !== null) {
          card.classList.add('has-number');
          if (positionCounts[userPos] > 1) {
            card.classList.add('duplicate-number');
          }
          // Warn if user entered a position that belongs to a fixed sentence
          if (fixedPositionValues.has(userPos)) {
            card.classList.add('duplicate-number');
          }
        }
        
        const highlightedText = highlightLinkingWords(text);
        
        // Build the available positions hint (exclude fixed positions)
        card.innerHTML = `
          <div class="sentence-label">S${originalIndex + 1}</div>
          <div class="sentence-content">
            <div class="sentence-text-display">${highlightedText}</div>
            <div class="sentence-input">
              <label>Order</label>
              <input type="number" 
                     id="input-${scrambledIdx}" 
                     min="1" 
                     max="${totalSentences}"
                     value="${userPos || ''}"
                     placeholder="#"
                     onblur="updatePosition(${scrambledIdx})"
                     onkeypress="if(event.key === 'Enter') { this.blur(); }">
            </div>
          </div>
        `;
        
        container.appendChild(card);
      });
      
      // Detect multi-line
      requestAnimationFrame(() => {
        document.querySelectorAll('.sentence-card').forEach(card => {
          const textDisplay = card.querySelector('.sentence-text-display');
          if (textDisplay) {
            const lineHeight = parseFloat(getComputedStyle(textDisplay).lineHeight);
            const height = textDisplay.offsetHeight;
            if (Math.round(height / lineHeight) > 1) {
              card.classList.add('multi-line');
            }
          }
        });
      });
    }

    function updatePosition(scrambledIdx) {
      const input = document.getElementById(`input-${scrambledIdx}`);
      const value = parseInt(input.value);
      
      if (value && value >= 1 && value <= totalSentences) {
        userPositions[scrambledIdx] = value;
        renderSentences();
      } else if (input.value === '') {
        delete userPositions[scrambledIdx];
        renderSentences();
      }
    }

    /**
     * CHECK ANSWER ‚Äî scores movable sentences only.
     * Fixed sentences are always correct by definition.
     */
    function checkAnswer() {
      if (hasSubmitted) return;
      
      // Validate all movable sentences have positions
      let allFilled = true;
      const userAnswers = []; // { scrambledIdx, userPos, originalIndex }
      
      movableSentences.forEach((item, scrambledIdx) => {
        const pos = userPositions[scrambledIdx];
        if (!pos || pos < 1 || pos > totalSentences) {
          allFilled = false;
        }
        userAnswers.push({
          scrambledIdx,
          userPos: pos || 0,
          originalIndex: item.originalIndex,
          correctPosition: item.correctPosition
        });
      });
      
      if (!allFilled) {
        alert('Please fill in all order numbers for the movable sentences (1 to ' + totalSentences + ').');
        return;
      }
      
      // Check for duplicates among movable positions
      const allPositions = userAnswers.map(a => a.userPos);
      const fixedPosValues = Object.values(fixedPositions);
      const combined = [...allPositions, ...fixedPosValues];
      
      if (new Set(combined).size !== combined.length) {
        // Find duplicates
        const seen = new Set();
        const dupes = new Set();
        combined.forEach(p => {
          if (seen.has(p)) dupes.add(p);
          seen.add(p);
        });
        
        const fixedDupes = [...dupes].filter(d => fixedPosValues.includes(d));
        if (fixedDupes.length > 0) {
          alert(`Position(s) ${fixedDupes.join(', ')} are already taken by fixed sentences. Choose different numbers.`);
        } else {
          alert('Each number can only be used once! Please check for duplicates.');
        }
        return;
      }
      
      hasSubmitted = true;
      
      // Score: compare user position to correct position
      let correctCount = 0;
      const correctMovable = new Set();
      
      userAnswers.forEach(a => {
        if (a.userPos === a.correctPosition) {
          correctCount++;
          correctMovable.add(a.scrambledIdx);
        }
      });
      
      // Mark cards
      userAnswers.forEach(a => {
        const card = document.getElementById(`card-movable-${a.scrambledIdx}`);
        if (card) {
          if (correctMovable.has(a.scrambledIdx)) {
            card.classList.add('correct');
            card.classList.remove('incorrect');
          } else {
            card.classList.add('incorrect');
            card.classList.remove('correct');
          }
        }
      });
      
      // Fixed sentences are always correct ‚Äî mark them
      Object.keys(fixedPositions).forEach(origIdx => {
        const card = document.getElementById(`card-fixed-${origIdx}`);
        if (card) card.classList.add('correct');
      });
      
      // Calculate percentage over ALL sentences (fixed + movable)
      const fixedCount = Object.keys(fixedPositions).length;
      const totalCorrect = correctCount + fixedCount;
      const percentage = Math.round((totalCorrect / totalSentences) * 100);
      
      showResults(percentage, totalCorrect);
    }

    function showResults(percentage, correctCount) {
      const resultsDiv = document.getElementById('resultsDisplay');
      const scoreEl = document.getElementById('resultsScore');
      const messageEl = document.getElementById('resultsMessage');
      
      scoreEl.textContent = `${percentage}%`;
      
      if (percentage === 100) {
        scoreEl.className = 'results-score perfect-score';
        messageEl.textContent = 'üéâ Perfect! You mastered this text structure!';
      } else if (percentage >= 80) {
        scoreEl.className = 'results-score';
        messageEl.textContent = `Great job! You got ${correctCount} out of ${totalSentences} correct!`;
      } else if (percentage >= 60) {
        scoreEl.className = 'results-score';
        messageEl.textContent = `Good effort! ${correctCount} out of ${totalSentences} correct. Try again!`;
      } else {
        scoreEl.className = 'results-score';
        messageEl.textContent = `${correctCount} out of ${totalSentences} correct. Keep practising!`;
      }
      
      resultsDiv.classList.add('show');
      document.getElementById('submitBtn').style.display = 'none';
      document.getElementById('retryBtn').style.display = 'inline-flex';
      document.getElementById('answersBtn').style.display = 'inline-flex';
    }

    function retry() {
      hasSubmitted = false;
      userPositions = {};
      showingAnswers = false;
      
      const answersBtn = document.getElementById('answersBtn');
      answersBtn.innerHTML = '<span class="btn-icon">üëÅ</span> Answers';
      answersBtn.classList.remove('showing-answers');
      answersBtn.style.display = 'none';
      document.getElementById('answerKeyDisplay').classList.remove('show');
      
      // Re-shuffle movable sentences
      shuffleArray(movableSentences);
      
      renderSentences();
      
      document.getElementById('resultsDisplay').classList.remove('show');
      document.getElementById('submitBtn').style.display = 'inline-flex';
      document.getElementById('retryBtn').style.display = 'none';
    }

    function toggleAnswers() {
      const answersBtn = document.getElementById('answersBtn');
      const answerKeyDisplay = document.getElementById('answerKeyDisplay');
      const answerKeyContent = document.getElementById('answerKeyContent');
      
      if (showingAnswers) {
        showingAnswers = false;
        answersBtn.innerHTML = '<span class="btn-icon">üëÅ</span> Answers';
        answersBtn.classList.remove('showing-answers');
        answerKeyDisplay.classList.remove('show');
      } else {
        showingAnswers = true;
        answersBtn.innerHTML = '<span class="btn-icon">‚úï</span> Hide';
        answersBtn.classList.add('showing-answers');
        
        answerKeyContent.innerHTML = '';
        sentences.forEach((sentence, index) => {
          const answerDiv = document.createElement('div');
          const isFixed = isFirstInParagraph[index];
          answerDiv.className = `answer-sentence${isFixed ? ' answer-fixed' : ''}`;
          
          const highlightedText = highlightLinkingWords(sentence);
          
          answerDiv.innerHTML = `
            <div class="answer-number">${index + 1}</div>
            <div class="answer-text">${highlightedText}${isFixed ? ' <span style="font-size:0.7rem;color:#C9A961;font-family:Space Grotesk,sans-serif;font-weight:700;">FIXED</span>' : ''}</div>
          `;
          
          answerKeyContent.appendChild(answerDiv);
        });
        
        answerKeyDisplay.classList.add('show');
      }
    }

    function newGame() {
      showingAnswers = false;
      const answersBtn = document.getElementById('answersBtn');
      answersBtn.innerHTML = '<span class="btn-icon">üëÅ</span> Answers';
      answersBtn.classList.remove('showing-answers');
      answersBtn.style.display = 'none';
      document.getElementById('answerKeyDisplay').classList.remove('show');
      
      window.location.href = 'index.html';
    }
  </script>
</body>
</html>
