<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>INTUITY - Sentence Sequencing</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Space+Grotesk:wght@400;500;600;700&family=DM+Sans:wght@400;500;600;700&family=Crimson+Text:wght@400;600;700&display=swap" rel="stylesheet">
  
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: 'DM Sans', 'Inter', -apple-system, BlinkMacSystemFont, 'SF Pro Display', sans-serif;
      background: #0d0d0d;
      color: white;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      overflow-x: hidden;
      min-height: 100vh;
      position: relative;
    }

    .background {
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      background: radial-gradient(circle at 30% 20%, rgba(201, 169, 97, 0.18) 0%, transparent 40%),
                  radial-gradient(circle at 70% 80%, rgba(201, 169, 97, 0.16) 0%, transparent 38%),
                  radial-gradient(circle at 20% 70%, rgba(201, 169, 97, 0.12) 0%, transparent 45%),
                  radial-gradient(circle at 85% 15%, rgba(201, 169, 97, 0.14) 0%, transparent 35%),
                  #0d0d0d;
      z-index: 0; overflow: hidden;
    }

    .elegant-curves { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; }
    .curve-elegant { position: absolute; border-radius: 50%; filter: blur(2px); }

    .curve-elegant-1 {
      width: 500px; height: 900px; top: -300px; right: -150px;
      border: 3px solid rgba(201, 169, 97, 0.35);
      background: linear-gradient(135deg, rgba(201, 169, 97, 0.15) 0%, rgba(201, 169, 97, 0.08) 50%, transparent 100%);
      transform: rotate(25deg); animation: floatElegant 12s ease-in-out infinite;
      box-shadow: inset 0 0 60px rgba(201, 169, 97, 0.1), 0 0 80px rgba(201, 169, 97, 0.15);
    }
    .curve-elegant-2 {
      width: 600px; height: 1100px; bottom: -400px; left: -200px;
      border: 2.5px solid rgba(201, 169, 97, 0.32);
      background: linear-gradient(135deg, rgba(201, 169, 97, 0.12) 0%, rgba(201, 169, 97, 0.06) 40%, transparent 80%);
      transform: rotate(-20deg); animation: floatElegant 15s ease-in-out infinite reverse;
      box-shadow: inset 0 0 50px rgba(201, 169, 97, 0.08), 0 0 70px rgba(201, 169, 97, 0.12);
    }
    .curve-elegant-3 {
      width: 400px; height: 750px; top: 25%; right: -50px;
      border: 2px solid rgba(201, 169, 97, 0.28);
      background: linear-gradient(135deg, rgba(201, 169, 97, 0.10) 0%, rgba(201, 169, 97, 0.05) 50%, transparent 90%);
      transform: rotate(45deg); animation: driftElegant 18s ease-in-out infinite;
    }
    .curve-elegant-4 {
      width: 450px; height: 850px; top: 50%; left: -100px;
      border: 2.5px solid rgba(201, 169, 97, 0.30);
      background: linear-gradient(135deg, rgba(201, 169, 97, 0.11) 0%, transparent 70%);
      transform: rotate(-35deg); animation: pulseElegant 20s ease-in-out infinite;
    }

    @keyframes floatElegant {
      0%, 100% { transform: translateY(0) rotate(var(--base-rotation, 0deg)); opacity: 1; }
      50% { transform: translateY(-30px) rotate(calc(var(--base-rotation, 0deg) + 3deg)); opacity: 0.85; }
    }
    @keyframes driftElegant {
      0%, 100% { transform: translate(0, 0) rotate(45deg); opacity: 1; }
      33% { transform: translate(20px, -25px) rotate(48deg); opacity: 0.9; }
      66% { transform: translate(-10px, -15px) rotate(42deg); opacity: 0.95; }
    }
    @keyframes pulseElegant {
      0%, 100% { transform: translate(0, 0) scale(1) rotate(-35deg); opacity: 1; }
      50% { transform: translate(-15px, 10px) scale(1.05) rotate(-33deg); opacity: 0.9; }
    }
    .curve-elegant-1 { --base-rotation: 25deg; }
    .curve-elegant-2 { --base-rotation: -20deg; }

    body::before {
      content: '';
      position: fixed; top: 0; left: 0; right: 0; bottom: 0;
      background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' /%3E%3C/filter%3E%3Crect width='100' height='100' filter='url(%23noise)' opacity='0.01'/%3E%3C/svg%3E");
      pointer-events: none; z-index: 1;
    }

    .container { max-width: 900px; margin: 0 auto; position: relative; z-index: 2; padding: 0 1rem; }

    .back-btn {
      position: fixed; top: 1.5rem; left: 1.5rem;
      padding: 0.625rem 1.25rem;
      background: rgba(28, 28, 30, 0.9);
      backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
      border: 1px solid rgba(84, 84, 88, 0.3);
      border-radius: 999px; color: #C9A961;
      font-size: 0.75rem; font-weight: 600;
      text-transform: uppercase; letter-spacing: 0.08em;
      cursor: pointer; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.5);
      z-index: 1000; display: flex; align-items: center; gap: 0.5rem;
    }
    .back-btn:hover { background: rgba(28, 28, 30, 1); border-color: rgba(201, 169, 97, 0.5); transform: translateX(-3px); }

    .header { text-align: center; margin-bottom: 2.5rem; padding: 1.5rem 0 1rem; }
    .header h1 {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 2.25rem; font-weight: 700; margin-bottom: 0.5rem; letter-spacing: -0.04em;
      text-transform: uppercase;
      background: linear-gradient(135deg, #C9A961 0%, rgba(201, 169, 97, 0.8) 100%);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
    }
    .header .subtitle { font-size: 0.8125rem; color: #8e8e93; font-weight: 500; letter-spacing: 0.04em; text-transform: uppercase; }

    .game-screen { display: none; padding: 1rem; }
    .game-screen.active { display: block; }

    .game-container {
      background: rgba(28, 28, 30, 0.98);
      backdrop-filter: blur(60px) saturate(180%); -webkit-backdrop-filter: blur(60px) saturate(180%);
      border: 1px solid rgba(84, 84, 88, 0.4);
      border-radius: 1.5rem;
      padding: 1.25rem 1rem 1.5rem;
      max-width: 900px; margin: 0 auto;
      box-shadow: 0 25px 50px rgba(0,0,0,0.6), 0 8px 24px rgba(0, 0, 0, 0.4);
    }

    .game-title {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 1.0625rem; font-weight: 600; color: #C9A961;
      text-align: center; margin-bottom: 0.25rem; padding-bottom: 0.625rem;
      border-bottom: 1px solid rgba(84, 84, 88, 0.3);
      text-transform: uppercase; letter-spacing: 0.02em;
    }
    .game-hint {
      text-align: center; font-size: 0.95rem;
      color: #6b7280; margin-bottom: 1rem;
      font-weight: 500;
    }

    /* TEXT DOCUMENT CONTAINER */
    .paragraphs-container {
      background: linear-gradient(180deg, rgba(250, 248, 245, 0.98) 0%, rgba(248, 246, 243, 0.98) 100%);
      border-radius: 1rem;
      border: 1px solid rgba(201, 169, 97, 0.2);
      padding: 2rem 2.5rem;
      margin-bottom: 1.25rem;
      max-height: 640px;
      overflow-y: auto;
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
      line-height: 1.8;
    }

    /* FIXED SENTENCE - TEXT STYLE */
    .fixed-sentence {
      background: rgba(250, 248, 245, 0.6);
      border: none;
      padding: 0.65rem 0.75rem;
      margin-bottom: 0.5rem;
      display: flex;
      gap: 0.75rem;
      align-items: flex-start;
      position: relative;
      cursor: default;
      border-radius: 0.375rem;
      transition: background 0.2s ease;
    }

    .fixed-sentence:hover {
      background: rgba(245, 243, 240, 0.7);
    }

    .fixed-sentence::before {
      display: none;
    }

    .fixed-sentence .sentence-label {
      font-family: 'DM Sans', sans-serif;
      font-size: 0.65rem;
      font-weight: 600;
      color: #8e8e93;
      background: transparent;
      padding: 0;
      border-radius: 0;
      text-align: left;
      min-width: 28px;
      flex-shrink: 0;
      opacity: 0.6;
    }

    .fixed-sentence .sentence-text {
      flex: 1;
      font-family: 'Crimson Text', serif;
      font-size: 1.05rem;
      line-height: 1.7;
      color: #1c1c1e;
      font-weight: 600;
    }

    .fixed-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.2rem;
      font-family: 'Space Grotesk', sans-serif;
      font-size: 0.5rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: #8e8e93;
      background: transparent;
      border: none;
      border-radius: 0;
      padding: 0;
      flex-shrink: 0;
      white-space: nowrap;
      opacity: 0.5;
    }

    .fixed-badge svg {
      width: 9px;
      height: 9px;
      fill: #8e8e93;
      opacity: 0.6;
    }

    /* TEXT LINES */
    .drop-slots {
      display: flex;
      flex-direction: column;
      gap: 0;
    }

    .drop-slot {
      min-height: auto;
      background: transparent;
      border: none;
      border-radius: 0;
      display: flex;
      align-items: flex-start;
      transition: all 0.2s ease;
      position: relative;
      margin-bottom: 0.5rem;
    }

    .drop-slot:last-child {
      margin-bottom: 0;
    }

    .drop-slot.drag-over {
      background: rgba(201, 169, 97, 0.08);
      border-radius: 0.375rem;
      padding: 0.25rem 0;
    }

    .drop-slot .sentence-card {
      margin-bottom: 0;
    }

    .drop-slot-label {
      font-size: 0.7rem;
      color: #6b7280;
      font-weight: 500;
      pointer-events: none;
    }

    /* SENTENCE LINE - TEXT STYLE */
    .sentence-card {
      background: rgba(250, 248, 245, 0.5);
      border: none;
      border-radius: 0.375rem;
      padding: 0.65rem 0.75rem;
      margin-bottom: 0.5rem;
      transition: all 0.2s ease;
      display: flex;
      gap: 0.75rem;
      align-items: flex-start;
      cursor: grab;
      position: relative;
      width: 100%;
      box-shadow: none;
    }

    /* Supporting sentence (will be indented when not first in paragraph) */
    .sentence-card.supporting {
      margin-left: 2rem;
      position: relative;
    }

    .sentence-card.supporting::before {
      content: '‚Ä¢';
      position: absolute;
      left: -1.25rem;
      top: 0.65rem;
      font-size: 1rem;
      color: #C9A961;
      font-weight: bold;
    }

    .sentence-card:hover {
      background: rgba(245, 240, 230, 0.7);
      box-shadow: 0 2px 8px rgba(201, 169, 97, 0.12);
    }

    .sentence-card:active {
      cursor: grabbing;
    }

    .sentence-card.dragging {
      opacity: 0.4;
      transform: none;
    }

    .sentence-card .sentence-label {
      font-family: 'DM Sans', sans-serif;
      font-size: 0.65rem;
      font-weight: 600;
      color: #8e8e93;
      background: transparent;
      padding: 0;
      border-radius: 0;
      text-align: left;
      min-width: 28px;
      flex-shrink: 0;
      opacity: 0.6;
    }

    .sentence-card .sentence-text {
      flex: 1;
      font-family: 'Crimson Text', serif;
      font-size: 1.05rem;
      line-height: 1.7;
      color: #1c1c1e;
      font-weight: 500;
    }

    .drag-handle {
      font-size: 0.9rem;
      color: #c9c9c9;
      cursor: grab;
      user-select: none;
      flex-shrink: 0;
      opacity: 0;
      transition: opacity 0.2s;
      margin-top: 0.2rem;
    }

    .sentence-card:hover .drag-handle {
      opacity: 0.4;
    }

    .drag-handle:active {
      cursor: grabbing;
    }

    /* CORRECT/INCORRECT STATES - SUBTLE */
    .sentence-card.correct {
      background: rgba(16, 185, 129, 0.1) !important;
      border-left: 3px solid #10b981;
      padding-left: 0.75rem !important;
      box-shadow: 0 2px 8px rgba(16, 185, 129, 0.15);
    }

    .sentence-card.supporting.correct {
      margin-left: 2rem;
    }

    .sentence-card.incorrect {
      background: rgba(239, 68, 68, 0.1) !important;
      border-left: 3px solid #ef4444;
      padding-left: 0.75rem !important;
      box-shadow: 0 2px 8px rgba(239, 68, 68, 0.15);
    }

    .sentence-card.supporting.incorrect {
      margin-left: 2rem;
    }

    .fixed-sentence.correct {
      border-left: 3px solid #10b981;
      padding-left: 0.75rem;
      background: rgba(16, 185, 129, 0.08);
      box-shadow: 0 2px 8px rgba(16, 185, 129, 0.12);
    }

    /* AVAILABLE SENTENCES POOL */
    .available-sentences {
      background: rgba(255, 255, 255, 0.02);
      border: 1px solid rgba(84, 84, 88, 0.2);
      border-radius: 0.875rem;
      padding: 0.75rem;
      margin-bottom: 1.25rem;
    }

    .available-header {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 0.75rem;
      font-weight: 700;
      color: #C9A961;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: 0.625rem;
      padding-bottom: 0.5rem;
      border-bottom: 1px solid rgba(201, 169, 97, 0.2);
    }

    .available-pool {
      display: flex;
      flex-direction: column;
      gap: 0.35rem;
      min-height: 60px;
    }

    .available-pool.empty {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1.5rem;
    }

    .empty-message {
      font-size: 0.8rem;
      color: #6b7280;
      font-weight: 500;
      text-align: center;
    }

    /* LINKING WORDS */
    .linking-word {
      color: #dc2626;
      font-weight: 700;
      padding: 0 0.125rem;
    }

    /* ACTION BAR */
    .game-actions {
      display: flex;
      gap: 0.5rem;
      justify-content: center;
      align-items: center;
      flex-wrap: wrap;
      background: rgba(255, 255, 255, 0.04);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      border: 1px solid rgba(255, 255, 255, 0.06);
      border-radius: 999px;
      padding: 0.35rem;
      max-width: fit-content;
      margin: 0 auto;
    }

    .game-btn {
      font-family: 'DM Sans', sans-serif;
      font-size: 0.7rem;
      font-weight: 600;
      letter-spacing: 0.01em;
      padding: 0.5rem 1.125rem;
      border: none;
      border-radius: 999px;
      cursor: pointer;
      transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      white-space: nowrap;
    }

    .game-btn .btn-icon {
      font-size: 0.85rem;
      line-height: 1;
    }

    .btn-submit {
      background: #C9A961;
      color: #111;
      font-weight: 700;
      box-shadow: 0 2px 10px rgba(201, 169, 97, 0.35);
    }

    .btn-submit:hover:not(:disabled) {
      background: #d4b46e;
      box-shadow: 0 4px 18px rgba(201, 169, 97, 0.5);
      transform: scale(1.04);
    }

    .btn-submit:active:not(:disabled) {
      transform: scale(0.97);
    }

    .btn-submit:disabled {
      opacity: 0.4;
      cursor: not-allowed;
    }

    .btn-retry {
      background: rgba(255, 255, 255, 0.08);
      color: #d4d4d8;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .btn-retry:hover {
      background: rgba(255, 255, 255, 0.14);
      color: #fff;
      transform: scale(1.04);
    }

    .btn-new {
      background: rgba(255, 255, 255, 0.05);
      color: #8e8e93;
      border: 1px solid rgba(255, 255, 255, 0.06);
    }

    .btn-new:hover {
      background: rgba(255, 255, 255, 0.1);
      color: #C9A961;
      transform: scale(1.04);
    }

    .btn-answers {
      background: rgba(99, 140, 255, 0.1);
      color: #7ba4ff;
      border: 1px solid rgba(99, 140, 255, 0.15);
    }

    .btn-answers:hover {
      background: rgba(99, 140, 255, 0.18);
      color: #a0bfff;
      transform: scale(1.04);
    }

    .btn-answers.showing-answers {
      background: rgba(99, 140, 255, 0.22);
      color: #fff;
      border-color: rgba(99, 140, 255, 0.3);
    }

    /* ANSWER KEY */
    .answer-key-display {
      display: none;
      background: linear-gradient(135deg, rgba(59, 130, 246, 0.12) 0%, rgba(37, 99, 235, 0.08) 100%);
      border: 2px solid rgba(59, 130, 246, 0.4);
      border-radius: 1.125rem;
      margin-bottom: 1.5rem;
      overflow: hidden;
    }

    .answer-key-display.show {
      display: block;
      animation: slideIn 0.4s ease-out;
    }

    .answer-key-header {
      background: linear-gradient(135deg, rgba(59, 130, 246, 0.2) 0%, rgba(37, 99, 235, 0.15) 100%);
      padding: 1rem 1.25rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid rgba(59, 130, 246, 0.3);
    }

    .answer-key-title {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 1rem;
      font-weight: 700;
      color: #3b82f6;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .close-answers {
      background: rgba(59, 130, 246, 0.15);
      border: 1px solid rgba(59, 130, 246, 0.3);
      color: #3b82f6;
      font-size: 1.25rem;
      font-weight: 700;
      width: 32px;
      height: 32px;
      border-radius: 0.5rem;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0;
    }

    .close-answers:hover {
      background: rgba(59, 130, 246, 0.25);
      transform: scale(1.1);
    }

    .answer-key-content {
      padding: 1.25rem;
      max-height: 400px;
      overflow-y: auto;
    }

    .answer-paragraph {
      margin-bottom: 1.5rem;
    }

    .answer-paragraph:last-child {
      margin-bottom: 0;
    }

    .answer-para-label {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 0.7rem;
      font-weight: 700;
      color: #3b82f6;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: 0.5rem;
    }

    .answer-sentence {
      display: flex;
      gap: 0.875rem;
      align-items: flex-start;
      padding: 0.75rem 1rem;
      margin-bottom: 0.5rem;
      background: rgba(255, 255, 255, 0.5);
      border-radius: 0.75rem;
      border-left: 4px solid #3b82f6;
    }

    .answer-sentence:last-child {
      margin-bottom: 0;
    }

    .answer-sentence.answer-fixed {
      background: rgba(201, 169, 97, 0.15);
      border-left: 4px solid #C9A961;
    }

    .answer-number {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 1.125rem;
      font-weight: 800;
      min-width: 32px;
      height: 32px;
      background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
      color: white;
      border-radius: 0.5rem;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }

    .answer-sentence.answer-fixed .answer-number {
      background: linear-gradient(135deg, #C9A961 0%, #B89650 100%);
      color: #1a1a2e;
    }

    .answer-text {
      flex: 1;
      font-family: 'Crimson Text', serif;
      font-size: 0.95rem;
      line-height: 1.5;
      color: #1c1c1e;
      font-weight: 600;
    }

    /* RESULTS */
    .results-display {
      display: none;
      background: linear-gradient(135deg, rgba(201, 169, 97, 0.15) 0%, rgba(201, 169, 97, 0.1) 100%);
      border: 2px solid rgba(201, 169, 97, 0.5);
      border-radius: 1.125rem;
      padding: 1.75rem;
      margin-bottom: 1.5rem;
      text-align: center;
    }

    .results-display.show {
      display: block;
      animation: slideIn 0.5s ease-out;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .results-score {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 2.75rem;
      font-weight: 800;
      color: #C9A961;
      margin-bottom: 0.625rem;
    }

    .results-message {
      font-size: 1.0625rem;
      color: #f5f5f7;
      font-weight: 500;
    }

    .perfect-score {
      color: #10b981;
    }

    /* SCROLLBAR */
    .paragraphs-container::-webkit-scrollbar,
    .answer-key-content::-webkit-scrollbar {
      width: 8px;
    }

    .paragraphs-container::-webkit-scrollbar-track,
    .answer-key-content::-webkit-scrollbar-track {
      background: rgba(0, 0, 0, 0.1);
      border-radius: 4px;
    }

    .paragraphs-container::-webkit-scrollbar-thumb,
    .answer-key-content::-webkit-scrollbar-thumb {
      background: linear-gradient(180deg, #C9A961 0%, #B89650 50%);
      border-radius: 4px;
    }

    @media (max-width: 768px) {
      .back-btn {
        top: 1rem;
        left: 1rem;
        padding: 0.5rem 1rem;
        font-size: 0.65rem;
      }

      .paragraphs-container {
        padding: 1.5rem 1.25rem;
      }

      .sentence-card,
      .fixed-sentence {
        padding: 0.6rem 0.65rem;
        font-size: 0.95rem;
      }

      .sentence-card.supporting {
        margin-left: 1.5rem;
      }

      .sentence-card.supporting::before {
        left: -1rem;
      }

      .game-btn {
        padding: 0.45rem 0.875rem;
        font-size: 0.65rem;
      }
    }
  </style>
</head>
<body>
  <div class="background">
    <div class="elegant-curves">
      <div class="curve-elegant curve-elegant-1"></div>
      <div class="curve-elegant curve-elegant-2"></div>
      <div class="curve-elegant curve-elegant-3"></div>
      <div class="curve-elegant curve-elegant-4"></div>
    </div>
  </div>

  <button class="back-btn" onclick="goBack()"><span>‚Üê</span><span>Back</span></button>

  <div class="container">
    <header class="header">
      <h1>INTUITY</h1>
      <p class="subtitle">Sentence Sequencing Challenge</p>
    </header>

    <div class="game-screen active" id="gameScreen">
      <div class="game-container">
        <h2 class="game-title" id="gameTitle"></h2>
        <p class="game-hint">Drag sentences to reorder them. The first and last sentences are fixed.</p>

        <div class="paragraphs-container" id="paragraphsContainer"></div>

        <div class="answer-key-display" id="answerKeyDisplay">
          <div class="answer-key-header">
            <span class="answer-key-title">‚úì Correct Sequence</span>
            <button class="close-answers" onclick="toggleAnswers()">‚úï</button>
          </div>
          <div class="answer-key-content" id="answerKeyContent"></div>
        </div>

        <div class="results-display" id="resultsDisplay">
          <div class="results-score" id="resultsScore">0%</div>
          <div class="results-message" id="resultsMessage">Keep trying!</div>
        </div>

        <div class="game-actions">
          <button class="game-btn btn-submit" id="submitBtn" onclick="checkAnswer()"><span class="btn-icon">‚úì</span> Check</button>
          <button class="game-btn btn-retry" id="retryBtn" onclick="retry()" style="display:none;"><span class="btn-icon">‚Üª</span> Retry</button>
          <button class="game-btn btn-answers" id="answersBtn" onclick="toggleAnswers()" style="display:none;"><span class="btn-icon">üëÅ</span> Answers</button>
          <button class="game-btn btn-new" onclick="newGame()"><span class="btn-icon">‚ü≥</span> New</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    let currentData = null;
    let currentSample = null;
    let paragraphsData = [];
    let draggedElement = null;
    let hasSubmitted = false;
    let showingAnswers = false;

    const LINKING_WORDS = [
      'however', 'therefore', 'moreover', 'furthermore', 'additionally', 'consequently',
      'meanwhile', 'nevertheless', 'nonetheless', 'thus', 'hence', 'accordingly',
      'besides', 'likewise', 'similarly', 'conversely', 'alternatively', 'specifically',
      'indeed', 'subsequently', 'finally', 'firstly', 'secondly', 'thirdly', 'lastly',
      'in addition', 'in contrast', 'for example', 'for instance', 'as a result',
      'on the other hand', 'in conclusion', 'to sum up', 'in summary', 'in brief',
      'in short', 'overall', 'essentially', 'basically', 'what is more',
      'to begin with', 'to start with', 'by far', 'it is generally agreed',
      'it was generally felt', 'one positive aspect', 'one major concern',
      'this is because', 'this is mainly due to', 'as a consequence', 'what makes', 'what made'
    ];

    const urlParams = new URLSearchParams(window.location.search);
    const contentType = urlParams.get('type') || 'essays';
    
    // Data paths - adjust based on actual file structure
    const DATA_PATHS = {
      essays: 'data/essays-models.json',
      reports: 'data/reports-models.json',
      reviews: 'data/reviews-models.json',
      emails: 'data/emails-models.json'
    };

    function goBack() {
      window.location.href = 'index.html';
    }

    window.addEventListener('DOMContentLoaded', () => startGame(contentType));

    async function startGame(type) {
      try {
        const response = await fetch(DATA_PATHS[type]);
        if (!response.ok) throw new Error(`Failed to load ${type}`);
        currentData = await response.json();
        currentSample = currentData.samples[Math.floor(Math.random() * currentData.samples.length)];
        extractParagraphs();
        document.getElementById('gameTitle').textContent = currentSample.topic || 'Sentence Sequencing Challenge';
        renderGame();
      } catch (e) {
        console.error(e);
        alert('Failed to load game data.');
      }
    }

    function extractParagraphs() {
      paragraphsData = [];
      let globalIndex = 0;
      let allSentences = [];

      // First pass: collect all sentences with their paragraph info
      currentSample.paragraphs.forEach((para, paraIdx) => {
        const sentences = para.text
          .split(/(?<=[.!?])\s+/)
          .filter(s => s.trim())
          .map(s => s.trim());

        sentences.forEach((text, sentIdx) => {
          allSentences.push({
            text,
            globalIndex,
            paraIdx,
            paraLabel: para.label,
            localIndex: sentIdx,
            isFirstInPara: sentIdx === 0  // Track if it's first in its paragraph
          });
          globalIndex++;
        });
      });

      // Determine which sentences are fixed (first and last globally)
      const totalSentences = allSentences.length;
      allSentences.forEach((sent, idx) => {
        sent.isFixed = (idx === 0 || idx === totalSentences - 1);
        sent.correctPosition = idx;
      });

      // Second pass: organize into paragraph structure
      currentSample.paragraphs.forEach((para, paraIdx) => {
        const paraData = {
          label: para.label,
          sentences: []
        };

        allSentences.forEach(sent => {
          if (sent.paraIdx === paraIdx) {
            paraData.sentences.push(sent);
          }
        });

        paragraphsData.push(paraData);
      });
    }

    function highlightLinkingWords(text) {
      let result = text;
      LINKING_WORDS.forEach(word => {
        const regex = new RegExp(`\\b(${word})\\b`, 'gi');
        result = result.replace(regex, '<span class="linking-word">$1</span>');
      });
      return result;
    }

    function renderGame() {
      hasSubmitted = false;
      document.getElementById('resultsDisplay').classList.remove('show');
      document.getElementById('submitBtn').style.display = 'inline-flex';
      document.getElementById('retryBtn').style.display = 'none';
      document.getElementById('answersBtn').style.display = 'none';
      document.getElementById('answerKeyDisplay').classList.remove('show');
      showingAnswers = false;

      renderParagraphs();
    }

    function renderParagraphs() {
      const container = document.getElementById('paragraphsContainer');
      container.innerHTML = '';

      // Collect all sentences in order
      let allSentences = [];
      paragraphsData.forEach(para => {
        allSentences.push(...para.sentences);
      });

      // Separate fixed and movable
      const fixedSentences = allSentences.filter(s => s.isFixed);
      const movableSentences = allSentences.filter(s => !s.isFixed);
      
      // Shuffle movable sentences
      shuffleArray(movableSentences);

      // Create a flat list with slots
      const totalSentences = allSentences.length;
      
      for (let i = 0; i < totalSentences; i++) {
        // Check if this position should have a fixed sentence
        const fixedSent = fixedSentences.find(s => s.correctPosition === i);
        
        if (fixedSent) {
          // Render fixed sentence
          const fixedDiv = document.createElement('div');
          fixedDiv.className = 'fixed-sentence';
          fixedDiv.dataset.position = i;
          fixedDiv.innerHTML = `
            <div class="sentence-label">S${fixedSent.globalIndex + 1}</div>
            <div class="sentence-text">${highlightLinkingWords(fixedSent.text)}</div>
            <div class="fixed-badge">
              <svg viewBox="0 0 16 16"><path d="M11.5 1a3.5 3.5 0 0 0-3.5 3.5V7H4a2 2 0 0 0-2 2v5a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2H9.5V4.5a2 2 0 1 1 4 0V6h1.5V4.5A3.5 3.5 0 0 0 11.5 1z"/></svg>
            </div>
          `;
          container.appendChild(fixedDiv);
        } else {
          // Render drop slot with movable sentence
          const slot = document.createElement('div');
          slot.className = 'drop-slot';
          slot.dataset.position = i;
          
          if (movableSentences.length > 0) {
            const sent = movableSentences.shift();
            const card = createSentenceCard(sent);
            slot.appendChild(card);
          }
          
          slot.addEventListener('dragover', handleDragOver);
          slot.addEventListener('dragleave', handleDragLeave);
          slot.addEventListener('drop', handleDrop);
          
          container.appendChild(slot);
        }
      }
    }

    function createSentenceCard(sentenceObj) {
      const card = document.createElement('div');
      card.className = 'sentence-card';
      
      // Add supporting class if not first in its paragraph
      if (!sentenceObj.isFirstInPara) {
        card.classList.add('supporting');
      }
      
      card.draggable = true;
      card.dataset.globalIndex = sentenceObj.globalIndex;
      card.dataset.correctPosition = sentenceObj.correctPosition;
      card.dataset.isFirstInPara = sentenceObj.isFirstInPara;

      card.innerHTML = `
        <div class="drag-handle">‚ãÆ‚ãÆ</div>
        <div class="sentence-label">S${sentenceObj.globalIndex + 1}</div>
        <div class="sentence-text">${highlightLinkingWords(sentenceObj.text)}</div>
      `;

      card.addEventListener('dragstart', handleDragStart);
      card.addEventListener('dragend', handleDragEnd);

      return card;
    }

    function handleDragStart(e) {
      draggedElement = e.currentTarget;
      e.currentTarget.classList.add('dragging');
      e.dataTransfer.effectAllowed = 'move';
      e.dataTransfer.setData('text/html', e.currentTarget.innerHTML);
    }

    function handleDragEnd(e) {
      e.currentTarget.classList.remove('dragging');
    }

    function handleDragOver(e) {
      if (e.preventDefault) e.preventDefault();
      e.dataTransfer.dropEffect = 'move';
      
      const slot = e.currentTarget;
      if (slot.classList.contains('drop-slot')) {
        slot.classList.add('drag-over');
      }
      
      return false;
    }

    function handleDragLeave(e) {
      e.currentTarget.classList.remove('drag-over');
    }

    function handleDrop(e) {
      if (e.stopPropagation) e.stopPropagation();
      e.preventDefault();

      const targetSlot = e.currentTarget;
      targetSlot.classList.remove('drag-over');

      if (!draggedElement) return false;

      const existingCard = targetSlot.querySelector('.sentence-card');
      const sourceSlot = draggedElement.parentElement;

      if (existingCard && existingCard !== draggedElement) {
        // Swap the cards
        sourceSlot.appendChild(existingCard);
      }

      targetSlot.appendChild(draggedElement);
      draggedElement = null;

      return false;
    }

    function checkAnswer() {
      if (hasSubmitted) return;

      let totalSentences = 0;
      let correctCount = 0;

      // Count fixed sentences as always correct
      const fixedCount = document.querySelectorAll('.fixed-sentence').length;
      totalSentences += fixedCount;
      correctCount += fixedCount;

      // Check all movable sentences
      const slots = document.querySelectorAll('.drop-slot');
      
      slots.forEach((slot) => {
        const position = parseInt(slot.dataset.position);
        const card = slot.querySelector('.sentence-card');
        
        if (card) {
          totalSentences++;
          const correctPosition = parseInt(card.dataset.correctPosition);
          
          if (correctPosition === position) {
            card.classList.add('correct');
            correctCount++;
          } else {
            card.classList.add('incorrect');
          }
        }
      });

      // Mark all fixed sentences as correct
      document.querySelectorAll('.fixed-sentence').forEach(fixed => {
        fixed.classList.add('correct');
      });

      hasSubmitted = true;
      const percentage = Math.round((correctCount / totalSentences) * 100);
      showResults(percentage, correctCount, totalSentences);
    }

    function showResults(percentage, correct, total) {
      const scoreEl = document.getElementById('resultsScore');
      const messageEl = document.getElementById('resultsMessage');

      scoreEl.textContent = `${percentage}%`;

      if (percentage === 100) {
        scoreEl.className = 'results-score perfect-score';
        messageEl.textContent = 'üéâ Perfect! You mastered this text structure!';
      } else if (percentage >= 80) {
        scoreEl.className = 'results-score';
        messageEl.textContent = `Great job! ${correct} out of ${total} correct!`;
      } else if (percentage >= 60) {
        scoreEl.className = 'results-score';
        messageEl.textContent = `Good effort! ${correct} out of ${total} correct. Try again!`;
      } else {
        scoreEl.className = 'results-score';
        messageEl.textContent = `${correct} out of ${total} correct. Keep practicing!`;
      }

      document.getElementById('resultsDisplay').classList.add('show');
      document.getElementById('submitBtn').style.display = 'none';
      document.getElementById('retryBtn').style.display = 'inline-flex';
      document.getElementById('answersBtn').style.display = 'inline-flex';

      // Disable dragging after submission
      document.querySelectorAll('.sentence-card').forEach(card => {
        card.draggable = false;
        card.style.cursor = 'default';
      });
    }

    function retry() {
      hasSubmitted = false;
      showingAnswers = false;
      
      document.getElementById('answersBtn').innerHTML = '<span class="btn-icon">üëÅ</span> Answers';
      document.getElementById('answersBtn').classList.remove('showing-answers');
      document.getElementById('answersBtn').style.display = 'none';
      document.getElementById('answerKeyDisplay').classList.remove('show');
      
      // Reset fixed sentences styling
      document.querySelectorAll('.fixed-sentence').forEach(fixed => {
        fixed.classList.remove('correct');
      });
      
      renderGame();
    }

    function toggleAnswers() {
      const btn = document.getElementById('answersBtn');
      const display = document.getElementById('answerKeyDisplay');
      const content = document.getElementById('answerKeyContent');

      if (showingAnswers) {
        showingAnswers = false;
        btn.innerHTML = '<span class="btn-icon">üëÅ</span> Answers';
        btn.classList.remove('showing-answers');
        display.classList.remove('show');
      } else {
        showingAnswers = true;
        btn.innerHTML = '<span class="btn-icon">‚úï</span> Hide';
        btn.classList.add('showing-answers');
        
        content.innerHTML = '';
        
        // Collect all sentences in correct order
        let allSentences = [];
        paragraphsData.forEach(para => {
          allSentences.push(...para.sentences);
        });
        
        // Sort by correct position
        allSentences.sort((a, b) => a.correctPosition - b.correctPosition);
        
        // Group by paragraph for display
        let currentParaIdx = -1;
        let paraDiv = null;
        
        allSentences.forEach((sent) => {
          if (sent.paraIdx !== currentParaIdx) {
            if (paraDiv) content.appendChild(paraDiv);
            
            paraDiv = document.createElement('div');
            paraDiv.className = 'answer-paragraph';
            
            const label = document.createElement('div');
            label.className = 'answer-para-label';
            label.textContent = sent.paraLabel;
            paraDiv.appendChild(label);
            
            currentParaIdx = sent.paraIdx;
          }
          
          const sentDiv = document.createElement('div');
          sentDiv.className = `answer-sentence${sent.isFixed ? ' answer-fixed' : ''}`;
          sentDiv.innerHTML = `
            <div class="answer-number">${sent.correctPosition + 1}</div>
            <div class="answer-text">${highlightLinkingWords(sent.text)}</div>
          `;
          paraDiv.appendChild(sentDiv);
        });
        
        if (paraDiv) content.appendChild(paraDiv);

        display.classList.add('show');
      }
    }

    function newGame() {
      window.location.href = 'index.html';
    }

    function shuffleArray(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
    }
  </script>
</body>
</html>
