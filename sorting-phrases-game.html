<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>INTUITY - Opening Lines Detective</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Space+Grotesk:wght@400;500;600;700&family=DM+Sans:wght@400;500;600;700&family=Crimson+Text:wght@400;600;700&display=swap" rel="stylesheet">
  
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: 'DM Sans', 'Inter', -apple-system, BlinkMacSystemFont, 'SF Pro Display', sans-serif;
      background: #0d0d0d;
      color: white;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      overflow-x: hidden;
      min-height: 100vh;
      position: relative;
    }

    .background {
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      background: radial-gradient(circle at 30% 20%, rgba(201, 169, 97, 0.18) 0%, transparent 40%),
                  radial-gradient(circle at 70% 80%, rgba(201, 169, 97, 0.16) 0%, transparent 38%),
                  radial-gradient(circle at 20% 70%, rgba(201, 169, 97, 0.12) 0%, transparent 45%),
                  radial-gradient(circle at 85% 15%, rgba(201, 169, 97, 0.14) 0%, transparent 35%),
                  #0d0d0d;
      z-index: 0;
      overflow: hidden;
    }

    .elegant-curves {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      pointer-events: none;
    }

    .curve-elegant {
      position: absolute;
      border-radius: 50%;
      filter: blur(2px);
    }

    .curve-elegant-1 {
      width: 500px;
      height: 900px;
      top: -300px;
      right: -150px;
      border: 3px solid rgba(201, 169, 97, 0.35);
      background: linear-gradient(135deg, rgba(201, 169, 97, 0.15) 0%, rgba(201, 169, 97, 0.08) 50%, transparent 100%);
      transform: rotate(25deg);
      animation: floatElegant 12s ease-in-out infinite;
      box-shadow: inset 0 0 60px rgba(201, 169, 97, 0.1), 0 0 80px rgba(201, 169, 97, 0.15);
    }

    .curve-elegant-2 {
      width: 600px;
      height: 1100px;
      bottom: -400px;
      left: -200px;
      border: 2.5px solid rgba(201, 169, 97, 0.32);
      background: linear-gradient(135deg, rgba(201, 169, 97, 0.12) 0%, rgba(201, 169, 97, 0.06) 40%, transparent 80%);
      transform: rotate(-20deg);
      animation: floatElegant 15s ease-in-out infinite reverse;
      box-shadow: inset 0 0 50px rgba(201, 169, 97, 0.08), 0 0 70px rgba(201, 169, 97, 0.12);
    }

    @keyframes floatElegant {
      0%, 100% { transform: translateY(0) rotate(var(--base-rotation, 0deg)); opacity: 1; }
      50% { transform: translateY(-30px) rotate(calc(var(--base-rotation, 0deg) + 3deg)); opacity: 0.85; }
    }

    .curve-elegant-1 { --base-rotation: 25deg; }
    .curve-elegant-2 { --base-rotation: -20deg; }

    body::before {
      content: '';
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' /%3E%3C/filter%3E%3Crect width='100' height='100' filter='url(%23noise)' opacity='0.01'/%3E%3C/svg%3E");
      pointer-events: none;
      z-index: 1;
    }

    .container { 
      max-width: 1100px; 
      margin: 0 auto; 
      position: relative;
      z-index: 2;
      padding: 0 1rem;
    }

    /* BACK BUTTON */
    .back-btn {
      position: fixed;
      top: 1.5rem;
      left: 1.5rem;
      padding: 0.625rem 1.25rem;
      background: rgba(28, 28, 30, 0.9);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(84, 84, 88, 0.3);
      border-radius: 999px;
      color: #C9A961;
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.5);
      z-index: 1000;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .back-btn:hover {
      background: rgba(28, 28, 30, 1);
      border-color: rgba(201, 169, 97, 0.5);
      transform: translateX(-3px);
    }

    /* HEADER */
    .header { 
      text-align: center; 
      margin-bottom: 2rem;
      padding: 1.5rem 0 1rem;
    }

    .header h1 {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 2.25rem; 
      font-weight: 700; 
      color: #C9A961;
      margin-bottom: 0.5rem; 
      letter-spacing: -0.04em;
      text-transform: uppercase;
      background: linear-gradient(135deg, #C9A961 0%, rgba(201, 169, 97, 0.8) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .header .subtitle { 
      font-size: 0.8125rem; 
      color: #8e8e93; 
      font-weight: 500;
      letter-spacing: 0.04em;
      text-transform: uppercase;
    }

    /* GAME CONTAINER */
    .game-container {
      background: rgba(28, 28, 30, 0.98);
      backdrop-filter: blur(60px) saturate(180%);
      border: 1px solid rgba(84, 84, 88, 0.4);
      border-radius: 1.5rem;
      padding: 1.5rem;
      box-shadow: 0 25px 50px rgba(0,0,0,0.6), 0 8px 24px rgba(0, 0, 0, 0.4);
      margin-bottom: 2rem;
    }

    /* LEVEL INDICATOR */
    .level-indicator {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1.5rem;
      padding: 1rem;
      background: linear-gradient(135deg, rgba(0, 0, 0, 0.4) 0%, rgba(0, 0, 0, 0.2) 100%);
      border-radius: 0.75rem;
      border: 1px solid rgba(84, 84, 88, 0.2);
    }

    .level-badge {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 0.875rem;
      font-weight: 700;
      color: #C9A961;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .round-counter {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 0.875rem;
      font-weight: 600;
      color: #8e8e93;
    }

    .timer {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 1.125rem;
      font-weight: 800;
      color: #C9A961;
      display: none;
    }

    .timer.show {
      display: block;
    }

    .timer.warning {
      color: #f59e0b;
      animation: pulseTimer 0.5s ease-in-out infinite;
    }

    @keyframes pulseTimer {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }

    /* STATS BAR */
    .stats-bar {
      display: flex;
      justify-content: space-around;
      align-items: center;
      padding: 1rem 1.25rem;
      background: linear-gradient(135deg, rgba(0, 0, 0, 0.4) 0%, rgba(0, 0, 0, 0.2) 100%);
      border-radius: 0.75rem;
      margin-bottom: 1.5rem;
      border: 1px solid rgba(84, 84, 88, 0.2);
      flex-wrap: wrap;
      gap: 1rem;
    }

    .stat-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.25rem;
    }

    .stat-label {
      font-size: 0.75rem;
      color: #8e8e93;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .stat-value {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 1.25rem;
      font-weight: 800;
      color: #C9A961;
    }

    /* GENRE CARDS AREA */
    .genre-cards-container {
      margin-bottom: 2rem;
    }

    .genre-cards-title {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 0.875rem;
      font-weight: 700;
      color: #C9A961;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: 1rem;
      text-align: center;
    }

    .genre-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    .genre-card {
      background: linear-gradient(135deg, rgba(0, 0, 0, 0.6) 0%, rgba(0, 0, 0, 0.4) 100%);
      border: 2px solid rgba(84, 84, 88, 0.3);
      border-radius: 1rem;
      padding: 1rem;
      min-height: 160px;
      transition: all 0.3s;
      position: relative;
    }

    .genre-card.drag-over {
      border-color: #C9A961;
      background: linear-gradient(135deg, rgba(201, 169, 97, 0.2) 0%, rgba(201, 169, 97, 0.1) 100%);
      box-shadow: 0 0 20px rgba(201, 169, 97, 0.3);
      transform: scale(1.02);
    }

    .genre-card-header {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 1rem;
      padding-bottom: 0.75rem;
      border-bottom: 1px solid rgba(84, 84, 88, 0.3);
    }

    .genre-icon {
      font-size: 1.5rem;
    }

    .genre-name {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 0.875rem;
      font-weight: 700;
      color: #e5e5e7;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .genre-dropzone {
      min-height: 80px;
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    /* Color-coded borders for genre cards */
    .genre-card[data-genre="essay"] { border-color: rgba(201, 169, 97, 0.5); }
    .genre-card[data-genre="review"] { border-color: rgba(59, 130, 246, 0.5); }
    .genre-card[data-genre="report"] { border-color: rgba(16, 185, 129, 0.5); }
    .genre-card[data-genre="email-formal"] { border-color: rgba(139, 92, 246, 0.5); }
    .genre-card[data-genre="email-informal"] { border-color: rgba(245, 158, 11, 0.5); }
    .genre-card[data-genre="essay-opinion"] { border-color: rgba(236, 72, 153, 0.5); }
    .genre-card[data-genre="report-community"] { border-color: rgba(6, 182, 212, 0.5); }

    /* SENTENCE POOL */
    .sentence-pool-container {
      background: linear-gradient(135deg, rgba(0, 0, 0, 0.4) 0%, rgba(0, 0, 0, 0.2) 100%);
      border-radius: 1rem;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      border: 1px solid rgba(84, 84, 88, 0.3);
    }

    .sentence-pool-title {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 0.875rem;
      font-weight: 700;
      color: #C9A961;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: 1rem;
      text-align: center;
    }

    .sentence-pool {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .sentence-item {
      background: linear-gradient(135deg, #F5F1E8 0%, #EBE6DC 100%);
      border: 2px solid rgba(201, 169, 97, 0.3);
      border-radius: 0.75rem;
      padding: 1rem;
      transition: all 0.3s;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08), 0 1px 3px rgba(0, 0, 0, 0.06);
    }

    .sentence-text {
      font-family: 'Crimson Text', serif;
      font-size: 1rem;
      line-height: 1.6;
      color: #1c1c1e;
      margin-bottom: 0.75rem;
      font-weight: 600;
    }

    .genre-buttons {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
      justify-content: center;
      align-items: center;
    }

    .genre-btn {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      padding: 0;
      border: none;
      border-radius: 0;
      cursor: pointer;
      transition: all 0.3s;
      background: transparent;
      color: #8e8e93;
      white-space: nowrap;
    }

    .genre-btn:hover {
      color: #C9A961;
      transform: scale(1.05);
    }

    .genre-btn.selected {
      color: #C9A961;
      font-weight: 800;
      transform: scale(1.1);
    }

    .sentence-item.answered {
      opacity: 0.7;
    }

    .sentence-item.correct {
      border-color: #10b981;
      background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%);
      animation: correctPulse 0.4s ease-out;
    }

    .sentence-item.incorrect {
      border-color: #ef4444;
      background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);
      animation: incorrectShake 0.4s ease-out;
    }

    .sentence-card {
      font-family: 'Crimson Text', serif;
      font-size: 0.875rem;
      line-height: 1.6;
      padding: 0.625rem 0.875rem;
      background: linear-gradient(135deg, #D1B982 0%, #E8D9B5 100%);
      border: 2px solid rgba(201, 169, 97, 0.5);
      border-radius: 0.5rem;
      color: #1c1c1e;
      margin-bottom: 0.25rem;
      font-weight: 600;
    }

    .sentence-card.correct {
      background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%);
      border-color: #10b981;
    }

    .sentence-card.incorrect {
      background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);
      border-color: #ef4444;
    }

    @keyframes correctPulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }

    @keyframes incorrectShake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-4px); }
      75% { transform: translateX(4px); }
    }

    /* FEEDBACK MODAL */
    .feedback-modal {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0.9);
      background: rgba(28, 28, 30, 0.98);
      backdrop-filter: blur(60px) saturate(180%);
      border: 2px solid rgba(201, 169, 97, 0.5);
      border-radius: 1.5rem;
      padding: 2rem;
      max-width: 600px;
      width: 90%;
      z-index: 2000;
      box-shadow: 0 25px 50px rgba(0,0,0,0.8);
      opacity: 0;
      transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    .feedback-modal.show {
      display: block;
      opacity: 1;
      transform: translate(-50%, -50%) scale(1);
    }

    .feedback-header {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    .feedback-icon {
      font-size: 3rem;
    }

    .feedback-title {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 1.25rem;
      font-weight: 700;
      color: #C9A961;
      text-transform: uppercase;
    }

    .feedback-content {
      margin-bottom: 1.5rem;
    }

    .feedback-sentence {
      font-family: 'Crimson Text', serif;
      font-size: 1.125rem;
      line-height: 1.8;
      color: #e5e5e7;
      margin-bottom: 1rem;
      padding: 1rem;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 0.75rem;
      border-left: 4px solid #C9A961;
    }

    .feedback-section {
      margin-bottom: 1rem;
    }

    .feedback-section-title {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 0.75rem;
      font-weight: 700;
      color: #C9A961;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: 0.5rem;
    }

    .feedback-section-text {
      font-size: 0.9375rem;
      line-height: 1.6;
      color: #e5e5e7;
    }

    .feedback-actions {
      display: flex;
      gap: 0.75rem;
      justify-content: center;
    }

    .feedback-btn {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 0.875rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      padding: 0.875rem 2rem;
      border: none;
      border-radius: 0.75rem;
      cursor: pointer;
      transition: all 0.3s;
    }

    .btn-continue {
      background: linear-gradient(135deg, #C9A961 0%, #B89650 100%);
      color: #1c1c1e;
      box-shadow: 0 4px 16px rgba(201, 169, 97, 0.4);
    }

    .btn-continue:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(201, 169, 97, 0.5);
    }

    /* RESULTS */
    .results-display {
      background: linear-gradient(135deg, rgba(201, 169, 97, 0.15) 0%, rgba(201, 169, 97, 0.1) 100%);
      border: 2px solid rgba(201, 169, 97, 0.5);
      border-radius: 1.125rem;
      padding: 2rem;
      text-align: center;
      display: none;
      margin-bottom: 1.5rem;
    }

    .results-display.show {
      display: block;
      animation: slideIn 0.5s ease-out;
    }

    @keyframes slideIn {
      from { opacity: 0; transform: translateY(-20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .results-title {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 1.5rem;
      font-weight: 700;
      color: #C9A961;
      margin-bottom: 1.5rem;
      text-transform: uppercase;
    }

    .results-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 1.5rem;
      margin-bottom: 1.5rem;
    }

    .result-stat {
      background: rgba(0, 0, 0, 0.3);
      border-radius: 0.75rem;
      padding: 1.25rem;
    }

    .result-stat-value {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 2rem;
      font-weight: 800;
      color: #C9A961;
      margin-bottom: 0.5rem;
    }

    .result-stat-value.perfect {
      color: #10b981;
    }

    .result-stat-label {
      font-size: 0.75rem;
      color: #8e8e93;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .results-analysis {
      background: rgba(0, 0, 0, 0.3);
      border-radius: 0.75rem;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      text-align: left;
    }

    .analysis-title {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 0.875rem;
      font-weight: 700;
      color: #C9A961;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: 1rem;
    }

    .analysis-item {
      margin-bottom: 0.75rem;
      font-size: 0.9375rem;
      color: #e5e5e7;
      line-height: 1.6;
    }

    /* ACTION BUTTONS */
    .game-actions {
      display: flex;
      gap: 0.75rem;
      justify-content: center;
      flex-wrap: wrap;
    }

    .game-btn {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 0.75rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      padding: 0.75rem 1.5rem;
      border: none;
      border-radius: 0.75rem;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    .btn-check {
      background: linear-gradient(135deg, #C9A961 0%, #B89650 100%);
      color: #1c1c1e;
      box-shadow: 0 4px 16px rgba(201, 169, 97, 0.4);
    }

    .btn-check:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(201, 169, 97, 0.5);
    }

    .btn-check:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .btn-secondary {
      background: linear-gradient(135deg, #F5F1E8 0%, #EBE6DC 100%);
      border: 2px solid #C9A961;
      color: #1c1c1e;
    }

    .btn-secondary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(201, 169, 97, 0.3);
    }

    /* MOBILE */
    @media (max-width: 768px) {
      .back-btn {
        top: 1rem;
        left: 1rem;
        padding: 0.5rem 1rem;
        font-size: 0.65rem;
      }

      .header h1 {
        font-size: 1.75rem;
      }

      .genre-cards {
        grid-template-columns: 1fr;
      }

      .sentence-item {
        padding: 0.875rem 1rem;
      }

      .sentence-text {
        font-size: 0.9375rem;
        margin-bottom: 0.625rem;
      }

      .genre-buttons {
        gap: 0.875rem;
      }

      .genre-btn {
        font-size: 0.6875rem;
      }

      .game-btn {
        padding: 0.625rem 1.125rem;
        font-size: 0.6875rem;
      }

      .stats-bar {
        flex-direction: column;
        gap: 0.75rem;
      }

      .feedback-modal {
        width: 95%;
        padding: 1.5rem;
      }
    }

    @media (max-width: 480px) {
      .sentence-text {
        font-size: 0.875rem;
      }

      .genre-buttons {
        gap: 0.75rem;
      }

      .genre-btn {
        font-size: 0.625rem;
      }

      .game-actions {
        gap: 0.5rem;
      }

      .game-btn {
        font-size: 0.625rem;
        padding: 0.5rem 1rem;
      }
    }
  </style>
</head>
<body>
  <div class="background">
    <div class="elegant-curves">
      <div class="curve-elegant curve-elegant-1"></div>
      <div class="curve-elegant curve-elegant-2"></div>
    </div>
  </div>

  <!-- BACK BUTTON -->
  <button class="back-btn" onclick="window.location.href='/index.html?openModal=writing&submenu=sentence-structure'">
    <span>‚Üê</span>
    <span>Back</span>
  </button>

  <div class="container">
    <!-- HEADER -->
    <header class="header">
      <h1>INTUITY</h1>
      <p class="subtitle">Opening Lines Detective</p>
    </header>

    <!-- GAME CONTAINER -->
    <div class="game-container">
      <!-- LEVEL INDICATOR -->
      <div class="level-indicator">
        <span class="level-badge" id="levelBadge">LEVEL 1: IDENTIFICATION</span>
        <span class="round-counter" id="roundCounter">Round 1/3</span>
        <span class="timer" id="timer">90</span>
      </div>

      <!-- STATS BAR -->
      <div class="stats-bar">
        <div class="stat-item">
          <span class="stat-label">Accuracy</span>
          <span class="stat-value" id="accuracyValue">0%</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Correct</span>
          <span class="stat-value" id="correctValue">0</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Incorrect</span>
          <span class="stat-value" id="incorrectValue">0</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Score</span>
          <span class="stat-value" id="scoreValue">0</span>
        </div>
      </div>

      <!-- GENRE CARDS AREA -->
      <div class="genre-cards-container">
        <div class="genre-cards-title">Drag sentences to their correct genre</div>
        <div class="genre-cards" id="genreCards">
          <!-- Genre cards will be inserted here -->
        </div>
      </div>

      <!-- SENTENCE POOL -->
      <div class="sentence-pool-container">
        <div class="sentence-pool-title">Opening Sentences</div>
        <div class="sentence-pool" id="sentencePool">
          <!-- Sentence cards will be inserted here -->
        </div>
      </div>

      <!-- RESULTS -->
      <div class="results-display" id="resultsDisplay">
        <div class="results-title" id="resultsTitle">Round Complete!</div>
        <div class="results-stats">
          <div class="result-stat">
            <div class="result-stat-value" id="finalAccuracy">0%</div>
            <div class="result-stat-label">Accuracy</div>
          </div>
          <div class="result-stat">
            <div class="result-stat-value" id="finalCorrect">0/0</div>
            <div class="result-stat-label">Correct</div>
          </div>
          <div class="result-stat">
            <div class="result-stat-value" id="finalScore">0</div>
            <div class="result-stat-label">Total Score</div>
          </div>
        </div>
        <div class="results-analysis" id="resultsAnalysis">
          <div class="analysis-title">üìä Performance Analysis</div>
          <div id="analysisContent"></div>
        </div>
      </div>

      <!-- ACTIONS -->
      <div class="game-actions">
        <button class="game-btn btn-check" id="checkBtn" onclick="checkAnswers()">Check Answers</button>
        <button class="game-btn btn-secondary" onclick="nextRound()">Next Round</button>
        <button class="game-btn btn-secondary" onclick="resetGame()">Restart Game</button>
      </div>
    </div>
  </div>

  <!-- FEEDBACK MODAL -->
  <div class="feedback-modal" id="feedbackModal">
    <div class="feedback-header">
      <div class="feedback-icon" id="feedbackIcon">‚ùå</div>
      <div class="feedback-title" id="feedbackTitle">Incorrect</div>
    </div>
    <div class="feedback-content">
      <div class="feedback-sentence" id="feedbackSentence"></div>
      <div class="feedback-section">
        <div class="feedback-section-title">üí° KEY CLUE</div>
        <div class="feedback-section-text" id="feedbackClue"></div>
      </div>
      <div class="feedback-section">
        <div class="feedback-section-title">üìù REGISTER MARKER</div>
        <div class="feedback-section-text" id="feedbackMarker"></div>
      </div>
    </div>
    <div class="feedback-actions">
      <button class="feedback-btn btn-continue" onclick="closeFeedback()">Continue</button>
    </div>
  </div>

  <script>
    // GAME DATA STRUCTURE - 4 CORE GENRES
    const GENRES = {
      essay: {
        name: 'Essay',
        icon: 'üìù',
        color: '#C9A961',
        sentences: [
          "Nowadays, technology is a regular part of everyday life.",
          "In recent years, social media has become a widely discussed issue.",
          "Many people argue that online learning has changed the way we study.",
          "It is common to hear different opinions about remote work.",
          "There is ongoing debate about whether automation does more good than harm.",
          "These days, environmental protection affects many people's lives.",
          "Few would deny that climate change has had a significant impact on how we live.",
          "People hold strong views about whether globalization is beneficial or harmful.",
          "It is widely accepted that education plays an important role in modern society.",
          "In recent years, the rise of artificial intelligence has sparked considerable debate."
        ],
        clue: "Essays introduce topics BROADLY using phrases like 'Nowadays' or 'In recent years' to set general context.",
        marker: "Uses temporal markers ('nowadays', 'in recent years') to introduce topics objectively without personal stance."
      },
      review: {
        name: 'Review',
        icon: '‚≠ê',
        color: '#3b82f6',
        sentences: [
          "Choosing a great film can be a real challenge.",
          "With so many options out there, it's hard to know what's actually worth your time.",
          "If you're looking for something that will keep you hooked, this series is a strong contender.",
          "Finding quality entertainment isn't as easy as it sounds.",
          "Every now and then, something comes along that reminds you why you love cinema.",
          "In a world of endless streaming options, this show manages to shine.",
          "Some releases fade quickly from memory, but this one is not one of them.",
          "After hearing so much about this film, I decided to see what the fuss was about.",
          "It's rare to find a book that truly lives up to the hype.",
          "The entertainment industry is crowded, but this production has carved out its own space."
        ],
        clue: "Reviews open with a RELATABLE PROBLEM or HOOK to engage readers emotionally before introducing the subject.",
        marker: "Creates reader connection through direct address ('you'), rhetorical problems, and conversational tone."
      },
      report: {
        name: 'Report',
        icon: 'üìä',
        color: '#10b981',
        sentences: [
          "The aim of this report is to assess the library facilities.",
          "This report looks at recent developments in the sports center.",
          "The purpose of this report is to evaluate student satisfaction.",
          "This report provides an overview of canteen services.",
          "The objective of this report is to analyze computer lab resources.",
          "This report examines the proposed shopping development in the town center.",
          "The aim of this report is to evaluate the new community center plans.",
          "This report seeks to investigate environmental concerns in the area.",
          "The purpose of this report is to assess traffic management measures.",
          "This report provides an analysis of public transport provision in the region."
        ],
        clue: "Reports EXPLICITLY STATE their purpose using formulaic phrases like 'The aim/purpose/objective of this report is to...'",
        marker: "Uses formal meta-discourse ('this report', 'the aim is to') and passive constructions to maintain objectivity."
      },
      email: {
        name: 'Email',
        icon: '‚úâÔ∏è',
        color: '#8b5cf6',
        sentences: [
          "I am writing to apply for the position of Marketing Manager advertised on your website.",
          "Please accept this email as my formal application for the role of Senior Designer.",
          "I would like to express my interest in the vacancy for Project Coordinator.",
          "I am writing to enquire about the course advertised in your brochure.",
          "I am contacting you in connection with the workshop taking place next month.",
          "I just read your message and I can't believe it!",
          "How's everything going?",
          "I'm really sorry about what happened.",
          "Are you doing anything this weekend?",
          "Thanks for telling me about the problem ‚Äî that sounds stressful."
        ],
        clue: "Emails vary dramatically: FORMAL uses 'I am writing to...' with full forms; INFORMAL uses contractions, exclamations, and direct emotion.",
        marker: "FORMAL: Formulaic openings, no contractions, professional register. INFORMAL: Contractions ('can't'), exclamations, direct questions, emotional responses."
      }
    };

    // Single level configuration - 5 rounds
    const LEVEL_CONFIG = {
      name: 'GENRE DETECTIVE',
      genres: ['essay', 'review', 'report', 'email'],
      sentencesPerGenre: 2,
      timeLimit: null,
      rounds: 5
    };

    // Game state
    let currentRound = 1;
    let currentSentences = [];
    let placements = {}; // {sentenceId: genreId}
    let correctCount = 0;
    let incorrectCount = 0;
    let totalScore = 0;
    let roundsCompleted = 0;
    let genreConfusion = {}; // Track which genres are confused

    // Initialize game
    function initGame() {
      currentRound = 1;
      totalScore = 0;
      roundsCompleted = 0;
      genreConfusion = {};
      loadRound();
    }

    function loadRound() {
      // Update UI
      document.getElementById('levelBadge').textContent = `${LEVEL_CONFIG.name}`;
      document.getElementById('roundCounter').textContent = `Round ${currentRound}/${LEVEL_CONFIG.rounds}`;
      
      // Reset timer (not used in this version)
      document.getElementById('timer').classList.remove('show');
      
      // Reset state
      placements = {};
      correctCount = 0;
      incorrectCount = 0;
      
      // Generate sentences
      currentSentences = generateSentences(LEVEL_CONFIG);
      
      // Render UI
      renderGenreCards(LEVEL_CONFIG.genres);
      renderSentencePool();
      updateStats();
      
      // Hide results
      document.getElementById('resultsDisplay').classList.remove('show');
    }

    function generateSentences(levelConfig) {
      const sentences = [];
      let sentenceId = 0;
      
      levelConfig.genres.forEach(genreId => {
        const genre = GENRES[genreId];
        const available = [...genre.sentences];
        
        // Shuffle and pick required number
        for (let i = 0; i < levelConfig.sentencesPerGenre && available.length > 0; i++) {
          const randomIndex = Math.floor(Math.random() * available.length);
          const sentence = available.splice(randomIndex, 1)[0];
          
          sentences.push({
            id: sentenceId++,
            text: sentence,
            correctGenre: genreId
          });
        }
      });
      
      // Shuffle all sentences
      return sentences.sort(() => Math.random() - 0.5);
    }

    function renderGenreCards(genres) {
      const container = document.getElementById('genreCards');
      container.innerHTML = '';
      
      genres.forEach(genreId => {
        const genre = GENRES[genreId];
        
        const card = document.createElement('div');
        card.className = 'genre-card';
        card.dataset.genre = genreId;
        
        card.innerHTML = `
          <div class="genre-card-header">
            <div class="genre-icon">${genre.icon}</div>
            <div class="genre-name">${genre.name}</div>
          </div>
          <div class="genre-dropzone" id="dropzone-${genreId}">
          </div>
        `;
        
        container.appendChild(card);
      });
      
      updateGenreCards();
    }

    function updateGenreCards() {
      // Clear all dropzones
      LEVEL_CONFIG.genres.forEach(genreId => {
        const dropzone = document.getElementById(`dropzone-${genreId}`);
        if (dropzone) dropzone.innerHTML = '';
      });
      
      // Add placed sentences to their genre cards
      Object.entries(placements).forEach(([sentenceId, genreId]) => {
        const sentence = currentSentences.find(s => s.id == sentenceId);
        if (!sentence) return;
        
        const dropzone = document.getElementById(`dropzone-${genreId}`);
        if (!dropzone) return;
        
        const card = document.createElement('div');
        card.className = 'sentence-card';
        card.dataset.sentenceId = sentenceId;
        card.textContent = sentence.text;
        
        dropzone.appendChild(card);
      });
    }

    function renderSentencePool() {
      const pool = document.getElementById('sentencePool');
      pool.innerHTML = '';
      
      currentSentences.forEach(sentence => {
        const item = document.createElement('div');
        item.className = 'sentence-item';
        item.dataset.sentenceId = sentence.id;
        
        // Sentence text
        const textDiv = document.createElement('div');
        textDiv.className = 'sentence-text';
        textDiv.textContent = sentence.text;
        
        // Genre button group
        const buttonGroup = document.createElement('div');
        buttonGroup.className = 'genre-buttons';
        
        LEVEL_CONFIG.genres.forEach(genreId => {
          const btn = document.createElement('button');
          btn.className = 'genre-btn';
          btn.textContent = GENRES[genreId].name;
          btn.dataset.genreId = genreId;
          
          // Check if this sentence already has this genre selected
          if (placements[sentence.id] === genreId) {
            btn.classList.add('selected');
            item.classList.add('answered');
          }
          
          btn.onclick = () => selectGenre(sentence.id, genreId);
          
          buttonGroup.appendChild(btn);
        });
        
        item.appendChild(textDiv);
        item.appendChild(buttonGroup);
        pool.appendChild(item);
      });
    }

    function selectGenre(sentenceId, genreId) {
      // Update placement
      placements[sentenceId] = genreId;
      
      // Update genre card
      updateGenreCards();
      
      // Re-render pool to show selection
      renderSentencePool();
      
      updateStats();
    }

    function updateStats() {
      const total = currentSentences.length;
      const placed = Object.keys(placements).length;
      
      document.getElementById('accuracyValue').textContent = 
        total > 0 ? Math.round((correctCount / total) * 100) + '%' : '0%';
      document.getElementById('correctValue').textContent = correctCount;
      document.getElementById('incorrectValue').textContent = incorrectCount;
      document.getElementById('scoreValue').textContent = totalScore;
      
      // Enable/disable check button
      document.getElementById('checkBtn').disabled = placed < total;
    }

    function checkAnswers() {
      let correct = 0;
      let incorrect = 0;
      const errors = [];
      
      currentSentences.forEach(sentence => {
        const userGenre = placements[sentence.id];
        const correctGenre = sentence.correctGenre;
        
        // Find sentence item in pool
        const sentenceItem = document.querySelector(`.sentence-item[data-sentence-id="${sentence.id}"]`);
        
        // Find sentence card in genre dropzone
        const dropzone = document.getElementById(`dropzone-${userGenre}`);
        const sentenceCard = dropzone ? dropzone.querySelector(`[data-sentence-id="${sentence.id}"]`) : null;
        
        if (userGenre === correctGenre) {
          correct++;
          if (sentenceItem) sentenceItem.classList.add('correct');
          if (sentenceCard) sentenceCard.classList.add('correct');
        } else {
          incorrect++;
          if (sentenceItem) sentenceItem.classList.add('incorrect');
          if (sentenceCard) sentenceCard.classList.add('incorrect');
          
          errors.push({
            sentence: sentence,
            userGenre: userGenre,
            correctGenre: correctGenre
          });
          
          // Track confusion
          const confusionKey = `${userGenre}-${correctGenre}`;
          genreConfusion[confusionKey] = (genreConfusion[confusionKey] || 0) + 1;
        }
      });
      
      correctCount = correct;
      incorrectCount = incorrect;
      
      // Calculate score (10 points per correct answer)
      const roundScore = correct * 10;
      totalScore += roundScore;
      
      updateStats();
      
      // Show feedback for first error
      if (errors.length > 0) {
        showFeedback(errors[0]);
      } else {
        // All correct - show results immediately
        showResults();
      }
    }

    function showFeedback(error) {
      const modal = document.getElementById('feedbackModal');
      const genre = GENRES[error.correctGenre];
      
      document.getElementById('feedbackIcon').textContent = '‚ùå';
      document.getElementById('feedbackTitle').textContent = 'Incorrect Placement';
      document.getElementById('feedbackSentence').textContent = `"${error.sentence.text}"`;
      document.getElementById('feedbackClue').textContent = genre.clue;
      document.getElementById('feedbackMarker').textContent = genre.marker;
      
      modal.classList.add('show');
    }

    function closeFeedback() {
      document.getElementById('feedbackModal').classList.remove('show');
      showResults();
    }

    function showResults() {
      const total = currentSentences.length;
      const accuracy = Math.round((correctCount / total) * 100);
      
      document.getElementById('resultsTitle').textContent = 
        accuracy === 100 ? 'üéâ Perfect Round!' : 
        accuracy >= 75 ? '‚ú® Excellent Work!' : 
        accuracy >= 50 ? 'Good Effort!' : 'Keep Practicing!';
      
      document.getElementById('finalAccuracy').textContent = accuracy + '%';
      if (accuracy === 100) {
        document.getElementById('finalAccuracy').classList.add('perfect');
      } else {
        document.getElementById('finalAccuracy').classList.remove('perfect');
      }
      
      document.getElementById('finalCorrect').textContent = `${correctCount}/${total}`;
      document.getElementById('finalScore').textContent = totalScore;
      
      // Generate analysis
      const analysisContent = document.getElementById('analysisContent');
      analysisContent.innerHTML = '';
      
      if (accuracy === 100) {
        analysisContent.innerHTML = '<div class="analysis-item">üåü Perfect score! You have excellent genre discrimination skills.</div>';
      } else {
        // Find most confused genres
        const confusionPairs = Object.entries(genreConfusion)
          .sort((a, b) => b[1] - a[1])
          .slice(0, 2);
        
        if (confusionPairs.length > 0) {
          confusionPairs.forEach(([pair, count]) => {
            const [userGenre, correctGenre] = pair.split('-');
            const userGenreName = GENRES[userGenre]?.name || 'Unknown';
            const correctGenreName = GENRES[correctGenre]?.name || 'Unknown';
            
            const item = document.createElement('div');
            item.className = 'analysis-item';
            item.textContent = `‚ö†Ô∏è Most confused: ${userGenreName} ‚Üî ${correctGenreName} (${count} error${count > 1 ? 's' : ''})`;
            analysisContent.appendChild(item);
          });
        }
        
        // Add recommendation
        const recommendation = document.createElement('div');
        recommendation.className = 'analysis-item';
        recommendation.textContent = 'üí° Practice identifying register markers and rhetorical purposes in opening sentences.';
        analysisContent.appendChild(recommendation);
      }
      
      document.getElementById('resultsDisplay').classList.add('show');
      roundsCompleted++;
    }

    function nextRound() {
      if (currentRound < LEVEL_CONFIG.rounds) {
        currentRound++;
        loadRound();
      } else {
        // Game complete
        alert(`üéä Game Complete! Final Score: ${totalScore}\n\nYou've completed all ${LEVEL_CONFIG.rounds} rounds!\n\nAccuracy: ${Math.round((totalScore / (LEVEL_CONFIG.rounds * 8 * 10)) * 100)}%`);
      }
    }

    function resetGame() {
      if (confirm('Are you sure you want to restart? All progress will be lost.')) {
        initGame();
      }
    }

    // Initialize game on load
    initGame();
  </script>
</body>
</html>
